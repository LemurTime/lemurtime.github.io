<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Matthew Pagett">
<meta name="dcterms.date" content="2025-11-01">
<meta name="description" content="Revisiting the first time I tried to get an LLM to write poetry">

<title>Writing Haiku with GPT-2 Without Finetuning – Matthew Pagett</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-5b4ad623e5705c0698d39aec6f10cf02.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Matthew Pagett</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/lemurtime"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/MatthewPagett"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Writing Haiku with GPT-2 Without Finetuning</h1>
                  <div>
        <div class="description">
          Revisiting the first time I tried to get an LLM to write poetry
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">LLM</div>
                <div class="quarto-category">code</div>
                <div class="quarto-category">Jetson Nano</div>
                <div class="quarto-category">PyTorch</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Matthew Pagett </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 1, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><strong>The early days of LLMs</strong></p>
<p>Six years ago, ChatGPT didn’t exist, and LLMs weren’t reasoning or doing people’s homework, but they were thrilling all the same. My machine learning journey started in 2018 - I was in South Sudan and trying to use AI to count cows from space. By late 2019, I was living in Madagascar, and bought a Jetson Nano to run ML models without depending on an internet connection. As a literature PhD, I wanted to see how well the LLM could generate creative work, and the haiku seemed like a good test case.</p>
<p>Around that time, some excellent GPT-2 haiku projects (such as https://github.com/brianweet/gpt-2-haiku) used fine-tuning to generate interesting results. The Jetson Nano didn’t have enough memory to fine-tune the model, so I experimented with the base model using inference alone.</p>
<p>I wrote code which prompted GPT-2 with a haiku-themed seed and then pieced together output of the right syllable count. Each poem took about one minute to generate, appearing upon a small external monitor until the next one was finished - an ephemeral dance accompanied by the furious spinning of the fan. The results were mostly absurd, but occasionally interesting.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Revisiting haiku generator_files/figure-html/5244627d-620f-4379-8d1b-5dd08b498921-1-5e1d9fb0-34c3-4e87-a03f-49537a3ab91a.JPG" class="img-fluid figure-img"></p>
<figcaption>IMG_2688.JPG</figcaption>
</figure>
</div>
<p>Recently, I wondered if a modern LLM assistant could write code to get better results from GPT-2.</p>
<p>GPT-2 now runs easily on a laptop. The examples below show the sort of output the model would produce without finetuning, quickly becoming incoherent. (I remember an early chatbot experiment that seemed to work fine until my spouse tested it. In an example of early AI safety red-teaming, she got it to generate an endless string of “DIE DIE DIE DIE DIE” within 5 turns.)</p>
<div id="3d3ae146-d071-42cc-9eba-b430ecb118e1" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> transformers</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This is what happens with prompts like “Haiku” or “Here is a Haiku:”</p>
<div id="a8af3cb9-7b2c-4d07-b31d-663dfe1304f8" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> pipeline, set_seed</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>generator <span class="op">=</span> pipeline(<span class="st">'text-generation'</span>, model<span class="op">=</span><span class="st">'gpt2'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>set_seed(<span class="dv">42</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="abca3d96-917c-46ab-ae0f-2daf17413e2a" class="cell" data-scrolled="true" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>generator(<span class="st">"Here is a haiku poem,"</span>, num_return_sequences<span class="op">=</span><span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting `pad_token_id` to `eos_token_id`:50256 for open-end generation.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>[{'generated_text': 'Here is a haiku poem, written by an American writer, in which he describes the story of the first American man to commit suicide in the world.\n\nThe poem is called "The Way of the Soldier."\n\nThe story about the first man to commit suicide in the world\n\nWritten by: Charles P. Smith, Jr.\n\nEdited by: Robert L. Williams\n\nThe poem was published in 1858 as a short story.\n\nThe poem was written about a man named "Vincent" who committed suicide, after which he read his own poem and asked for forgiveness from his fellow citizens.\n\nIn 1859, Vincent wrote, "I am a man of spirit, a man of courage. A man of courage. A man of spirit. A man of courage. A man of courage."\n\nVincent continued, "I am not afraid of anything, of the world, of life. I am not afraid of any thing, of my fellow men, of the world, of death. I am not afraid of the world. I am not afraid of anything, of the world, of life. I am not afraid of any thing, of the world, of death. I am not afraid of any thing, of my fellow men, of the world'},
 {'generated_text': 'Here is a haiku poem, "To die for my name" by Nils Nils.\n\nThis is the original poem by Nils Nils.\n\nThe first part was composed for the novel "The Long Night".\n\nThe second part was composed for the novel "The Long Night" by Nils Nils.\n\nThe third part was composed for the novel "The Long Night" by Nils Nils.\n\nThe fourth part was composed for the novel "The Long Night" by Nils Nils.\n\nThe fifth part was composed for the novel "The Long Night" by Nils Nils.\n\nThe sixth part was composed for the novel "The Long Night" by Nils Nils.\n\nThe seventh part was composed for the novel "The Long Night" by Nils Nils.\n\n\nThe eighth part was composed for the novel "The Long Night" by Nils Nils.\n\n\nThe ninth part was composed for the novel "The Long Night" by Nils Nils.\n\n\nThe tenth part was composed for the novel "The Long Night" by Nils Nils.\n\n\nThe eleventh part was composed for the novel "The Long Night" by Nils Nils.\n\nThe tw'},
 {'generated_text': 'Here is a haiku poem, adapted from a poem about a young boy:\n\nI am the son of an old man,\n\nand the father of a young girl.\n\nAnd the day of the coming of the sun,\n\nthe year, the year,\n\nthe year of heaven.\n\nI am the son of an old man, and the father of a young girl.\n\nBut when the sun comes, the year, the year of heaven,\n\nthe year of the moon,\n\nthe year of the stars,\n\nand the year of the angels;\n\nI am the son of an old man, and the father of a young girl.\n\nBut when the sun comes, the year, the year of heaven,\n\nthe year of the moon,\n\nthe year of the stars,\n\nand the year of the angels;\n\nI am the son of an old man, and the father of a young girl.\n\nBut when the sun comes, the year, the year of heaven,\n\nthe year of the moon,\n\nthe year of the stars,\n\nand the year of the angels;\n\nI am the son of an old man, and the father of a young girl.'},
 {'generated_text': "Here is a haiku poem, which I found on my way to work.\n\nI read it for the first time in my head when I was a kid and it's a pretty short poem about a boy who loves to eat. It's a good story about a boy who's lost his love and ends up as a child.\n\nThere is a scene where a young girl comes to the end of the story, and she's crying and she says the word 'love' and what am I doing to my mom and dad and what about my dad. And the girl says, 'I love you too and I am your best friend, oh my god, I love you too!' And she goes, 'I love you, my mommy loves you too. I love you too, my mommy loves you too.' I think that's a good bit of emotional empathy, if you will.\n\nIt's a pretty short story. On my back are a few words that I've said often enough, but I think the gist is this:\n\nI love you, my mommy loves you too. I love you, my mommy loves you too. I love you, my mommy loves you too. I love you, my mommy loves you too.\n\nThere"},
 {'generated_text': 'Here is a haiku poem, from a popular Japanese language book, published in the early 1950s, by the famous Japanese singer Takayuki Utsukai.\n\n\nThe poem was sung at the University of California, Berkeley in 1952. It was featured in a film called "The Love Song of the Spring".\n\n\nThe film\'s star was Takayuki Utsukai. In the film, Utsukai was portrayed by a young Japanese man named Akiyobu Suzuki, and the film\'s director was the Japanese novelist Yoshinori Kitano.\n\n\nUtsukai\'s name was also mentioned as a character in "Love Song of the Spring".\n\n\nThe poem was translated into English by the English version of the popular Japanese manga series "One Piece". The novel\'s title refers to the title character, Utsukai.\n\n\nThe poem was also adapted into the novel by the singer-songwriter Otsuki Yoshinori.\n\n\nIn the novel, this haiku poem was read aloud and translated into Japanese.\n\n\nUtsukai was also an idol in the idol group the Kinkaku Yakuza.\n\n\nIn addition to a song, there were also other haikus included in the anime.\n\n\nThere were'}]</code></pre>
</div>
</div>
<div id="260eb8d9-9466-48e9-8313-92733a6e1fd0" class="cell" data-scrolled="true" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>generator(<span class="st">"HAIKU:"</span>, num_return_sequences<span class="op">=</span><span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting `pad_token_id` to `eos_token_id`:50256 for open-end generation.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>[{'generated_text': 'HAIKU: Right. I want to tell you, I\'m not going to go into detail about what he does there, but he\'s a big fan of a lot of the things you can relate to in terms of the things he\'s doing here. He\'s just a really great guy. He\'s really into the game. He has a lot of love for the game and wants to try to make it better. I could go on and on. But I\'m going to leave it there.\n\nQ: If there\'s anything you would like to add in the future, what would it be?\n\nA: I\'m sure we\'ll get to that. I\'m sure you\'ll have to wait and see.\n\nQ: I know you said you were going to do the "No-Sell List" thing. Are you still looking for a new GM?\n\nA: I\'m definitely looking to do it. I\'m sure I\'ve done it before. I\'m not looking to do that. I\'m just looking to hire somebody who can bring that expertise to the table.\n\nQ: Do you have any specific plans for next season?\n\nA: We\'ve got a lot of work ahead of us on that. I\'m excited for what'},
 {'generated_text': 'HAIKU: You saw that? (laughs) I think he was making a lot of money. It was like, "Oh my God, that\'s going to be a lot bigger than what I paid for."\n\nMARK: It was. (laughs)\n\nKATIE: It was. You got to see it. I got to see it.\n\nMARK: So, I mean, I mean, that\'s what a lot of us do. We were all working on the film and we got to see it.\n\nKATIE: Yeah, yeah.\n\nMARK: How about when you\'re working on a film, how do you get to see it and what do you get to see?\n\nKATIE: Well, I get to see it when I\'m working on a film. And I get to see it when I\'m working on a film.\n\nMARK: Oh, you\'re right.\n\nKATIE: The last time I saw it, it was a little bit darker than it was in the first place.\n\nMARK: (laughs)\n\nKATIE: I mean, it\'s a little bit darker. And when I was making that movie, I was feeling'},
 {'generated_text': 'HAIKU: The Unfair Test Demon, Aamir Demon God Dragon, Baal awoken sinner Demon King, Zaerog∞ Demon Lord, Belial Demon King, Cauchemar Demon Man, Metatron Demon Messenger, Metatron TAMADRA Fallen Angel Lucifer Fastest Sky Pirate, Balthier Demon Lord, Belial Demon Lord, Buster Siegfried Demon Lord, Buster Siegfried Protector of the Sea, Ganesha Demon God, Ra Dragon Anubis Demon God of Fury, Ares demon of the damned, beelzebub Demon God of the Climactic Night, Lucifer Demon God of the Night, Tsukuyomi Dragon Anubis Demon God of Steel, Verra Demon which Kill Devil Dragon, Canopus Ateria Demon Weal, Shouki Demon Blade Brave, Kopisubi The Flash Maleficent Dragon Lord Zaerog∞ Demon Lord, Furi Zoldyck Thunderdragon Indra Thundering CyberDragon, Shedar Thunderlord Shocker Thunderlord Zinogre Thunderous Demon Princess, Raijin Thunderous Screaming Demon Count, Ronove Thundershock Tiger Dragon, Balidoora Thunderstone Edge, Caladbolg Tiamat Tidus Tifa Tigrex Tigrex &amp; Rex Cat Timbel Armor X Dragon Caller, Ana Time Guardians, Tak'},
 {'generated_text': "HAIKU: The Demon's Trap The Game The Challenge The Chaos Engine The Charming Empire The Charnel House Trilogy The Chosen RPG The Chosen Warriors The chronicles of Emerland. Solitaire. The Clans - Saga of the Twins The Cleansing The Collider The Collider 2 The Coma The Coma: Recut The Concourse The Confines Of The Crown The Construct The Consuming Shadow The Cooking Game The Corridor: On Behalf Of The Dead The Council The Count Lucanor The Counting Kingdom The Crooked Man The Crow's Eye The Crowded Party Game Collection The Crypts of Anak Shaba - VR The Culling Of The Cows The Curious Expedition The Cursed Forest The Dark Eye: Chains of Satinav The Dark Inside Me The Dark Legions The Dark Stone from Mebara The Dark Tales of Katarina The Darkside Detective The Dead Linger The Deadly Tower of Monsters The Deal The Decimation of Olarath The Deed The Deed: Dynasty The Deer The Deer God The Defenders: The Second Wave The Deletion The Descendant The Detail The Dishwasher: Vampire Smile The Disney Afternoon Collection The District The Divine Paradox The Dolls The Dope Game The Dream Machine The Dreamatorium of Dr. Magnus 2 The Dreamlord The"},
 {'generated_text': "HAIKU: That's the kind of story I always wanted to hear. I have a family that I don't really know well, but I've had some good conversations with other families. I'm a professional hockey player, and I'm a professional broadcaster, and I've seen a lot of great things in the past, but I'm not sure yet how I would want to continue playing hockey in my life.\n\nA: When we were talking about the future, you were talking about a certain player, but it was also about you and the guys, and the team, and the fans, and the fans—you were doing a great job.\n\nAdvertisement\n\nQ: And you're not going to play for the team again?\n\nA: No, I'm not going to play for the team in any way.\n\nQ: You're not going to play for the team, but you're going to play for a certain team?\n\nAdvertisement\n\nA: No, I'm going to play for a certain team. So all of a sudden, I'm going to play for the team.\n\nQ: I've been told it's about a certain player, but I'm not going to play for it?\n\nA: No"}]</code></pre>
</div>
</div>
<p>Here’s an example of using the first words of a famous haiku as a prompt, to see if the model can generate the next few lines (it doesn’t).</p>
<div id="2715a5b6-311d-4181-b567-f9cf4c9e3828" class="cell" data-scrolled="true" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>generator(<span class="st">"Old pond a frog jumps"</span>, num_return_sequences<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#expected completion - "the sound of water"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting `pad_token_id` to `eos_token_id`:50256 for open-end generation.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>[{'generated_text': 'Old pond a frog jumps up from under the water to attack a crocodile.\n\nA frog jumps up from under the water to attack a crocodile.\n\nA frog jumps up from under the water to attack a crocodile.\n\nA frog jumps up from under the water to attack a crocodile.\n\nA frog jumps up from under the water to attack a crocodile.\n\nA frog jumps up from under the water to attack a crocodile.\n\nA frog jumps up from under the water to attack a crocodile.\n\nA frog jumps up from under the water to attack a crocodile.\n\nA frog jumps up from under the water to attack a crocodile.\n\nA frog jumps up from under the water to attack a crocodile.\n\nA frog jumps up from under the water to attack a crocodile.\n\nA frog jumps up from under the water to attack a crocodile.\n\nA frog jumps up from under the water to attack a crocodile.\n\nA frog jumps up from under the water to attack a crocodile.\n\nA frog jumps up from under the water to attack a crocodile.\n\nA frog jumps up from under the water to attack a crocodile.\n\nA frog jumps'},
 {'generated_text': 'Old pond a frog jumps over a pond.\n\nA frog jumps over a pond. A large frog climbs up a large pond.\n\nA frog jumps over a pond. A small frog climbs over a small pond.\n\nA frog jumps over a pond. A large frog jumps over a pond.\n\nA frog jumps over a pond. A small frog jumps over a small pond.\n\nA frog jumps over a pond. A small frog jumps over a small pond.\n\nA frog jumps over a pond. A small frog jumps over a small pond.\n\nA frog jumps over a pond. A small frog jumps over a small pond.\n\nA frog jumps over a pond. A small frog jumps over a small pond.\n\nA frog jumps over a pond. A small frog jumps over a small pond.\n\nA frog jumps over a pond. A small frog jumps over a small pond.\n\nA frog jumps over a pond. A small frog jumps over a small pond.\n\nA frog jumps over a pond. A small frog jumps over a small pond.\n\nA frog jumps over a pond. A small frog jumps over a small pond.\n\nA frog jumps over a pond. A small frog jumps over a small pond.\n'},
 {'generated_text': 'Old pond a frog jumps over.\n\nIn addition to being a common sight, however, it is also sometimes called a "watermelon" because of its color.\n\nWhat is a "pest" instead?\n\nThere are many different types of pest, and it is a common misconception that you need to know how to properly identify one.\n\nThere are different types of pest - the common, the exotic, and the exotic.\n\nThe exotic is a watermelon, and the common variety is a potted fruit.\n\nThe exotic is a watermelon with a little blood on the flesh.\n\nIn terms of flavor, the potted fruit is a bit more sweet, and the exotic is a bit more "sugar."\n\nThe exotic is also known as a red-orange, and the common variety is a red-orange.\n\nOne of the most common types of pest is called a "watermelon" because it is yellowish.\n\nThe common variety is called "potted fruit," but for some reason it is more common for the red-orange variety to be called a "potted fruit."\n\nThe exotic variety is called a "potted fruit," but for some reason, it is more common for'},
 {'generated_text': 'Old pond a frog jumps over.\n\n"I\'m not going to tell you a secret," she says. "I\'m not going to tell you a secret, but I do want to tell you something. But you\'ve got to remember the name and what it means. It\'s the name of this village. It\'s the name of a village. And I\'m going to tell you how it all started."\n\n"What," says the girl.\n\n"I was just talking to a local girl," says the frog. "We met over a beer. She said she wanted to know the village name. Why didn\'t you tell her?"\n\n"Because it was too hard for us to find out. It\'s not even a village, isn\'t it?"\n\n"No, it\'s a village," says the frog. "You see the name of this girl in the book, right? It\'s here. It was here before the war. It\'s the name of this village. It\'s the name of a village. And I was so embarrassed that I couldn\'t tell her. I had to put it away."\n\n"I knew you wouldn\'t know any better," answers the girl.'},
 {'generated_text': 'Old pond a frog jumps into the water. The frogs swim around the pond and go back to the pond. Eventually they get to the bottom of the pond. They make it to the bottom where they drown. The next morning the water is clear and the frogs start swimming again. Eventually they are able to get to the top of the pond and they all swim back down the hill.\n\n\nThis is the only way to get to the top of the pond.\n\n\nThe frog is back to the pond and when he comes back it is time to go back to the pond to get some water. The water is clear and the frog is right back up the hill.\n\n\nThe frog is back to the pond and he is back to the pond.'}]</code></pre>
</div>
</div>
<p>My 2020 method (prompting based on a haiku-related seed word) was essentially an ‘accidental haiku finder’ combining generative text and procedural generation. <em>(Spoiler alert - thanks to Claude, I’ve now figured out that a few-shot approach would have generated better results without finetuning!)</em></p>
<div id="b1ab98a9-ae7f-48c9-9427-83ed3f1f7e68" class="cell">
<details class="code-fold">
<summary>Show the 2020 code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">##General verse_gen - input is input, number of syllables required</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> verse_gen(verse_input, syllable_length):</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> verse_words</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> verse_string</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> verse_count</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> verse_syllable_count</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Go to first whitespace, count syllables.  Continue until "syllable_length" syllables.  If over required amount syllables try with new input.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">#initialize counters</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">#left side location in string</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="dv">0</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">#right side location in string</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="dv">1</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">#counter for number of times to try this before getting new input</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    z<span class="op">=</span><span class="dv">0</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">#initial syllable count of zero</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    verse_syllable_count<span class="op">=</span><span class="dv">0</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Split the input to make it a list of words</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    verse_words<span class="op">=</span>verse_input.split(<span class="st">' '</span>)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="co">#Set a counter - try this a number of times then move on</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> z <span class="op">&lt;</span> <span class="dv">40</span>:</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> verse_syllable_count <span class="op">&lt;</span> syllable_length:</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"Adding next word to the string"</span>)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>            <span class="co">#Put words from y to x in a string</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>            verse_string<span class="op">=</span><span class="st">' '</span>.join(verse_words[y:x])</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>            <span class="co">#If no special characters, Count the syllables</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>            <span class="co">#Validate haiku-able phrases.  If not, reinitialize the string and keep going</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>            <span class="co">#Get rid of any phrase with numerals or special characters in it</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> re.match(<span class="st">"^[a-zA-Z</span><span class="er">\</span><span class="st">s-]*$"</span>, verse_string):</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>                verse_syllable_count <span class="op">=</span> syllapy.count(verse_string)</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>                <span class="co">#increment x</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>x<span class="op">+</span><span class="dv">1</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>                <span class="co">#increment z</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>                z<span class="op">=</span>z<span class="op">+</span><span class="dv">1</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>                <span class="co">#print the string</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(verse_string)</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(verse_string, <span class="st">"Invalid characters. Moving up in string."</span>)</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>                <span class="co">#reinitialize verse_string</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>                verse_string<span class="op">=</span><span class="st">""</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>                verse_syllable_count<span class="op">=</span><span class="dv">0</span></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span>y<span class="op">+</span><span class="dv">1</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> verse_syllable_count <span class="op">==</span> syllable_length:</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>            <span class="co">#Get rid of any trailing spaces</span></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>            verse_string <span class="op">=</span> verse_string.strip()</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>            last_word<span class="op">=</span>verse_string.split(<span class="st">" "</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>            <span class="co">#Get rid of any phrase ending in an article or preposition words</span></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>            bad_word_list <span class="op">=</span> <span class="st">'as of the and if or at by our your my'</span></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>            bad_word_set <span class="op">=</span> <span class="bu">set</span>(bad_word_list.split())</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (last_word <span class="kw">in</span> bad_word_set):</span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(verse_string, <span class="st">": String ends in article or other undesirable word.  Moving up in string"</span>)</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>                <span class="co">#reinitialize verse_string</span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>                verse_string<span class="op">=</span><span class="st">""</span></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>                verse_syllable_count<span class="op">=</span><span class="dv">0</span></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span>y<span class="op">+</span><span class="dv">1</span></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>            <span class="co">#If successful, print string and return    </span></span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">"Haiku line found:</span><span class="ch">\n</span><span class="st">"</span>, verse_string)</span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> verse_string</span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> verse_syllable_count <span class="op">&gt;</span> syllable_length:</span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>            <span class="co">#If string is too long, reinitialize the string and keep going</span></span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(verse_string, <span class="st">": String too long. Moving up in string."</span>)</span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>            <span class="co">#reinitialize verse_string</span></span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>            verse_string<span class="op">=</span><span class="st">""</span></span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a>            verse_syllable_count<span class="op">=</span><span class="dv">0</span></span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span>y<span class="op">+</span><span class="dv">1</span></span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>            <span class="co">#verse_gen(verse_input, syllable_length)</span></span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Get a new string and start over if this string doesn't work</span></span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> z <span class="op">==</span> <span class="dv">40</span>:</span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Getting new input."</span>)</span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a>        <span class="co">#text_generator(state_dict)   </span></span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a>        verse_input <span class="op">=</span> GPT2_output</span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a>        verse_string<span class="op">=</span>verse_gen(verse_input, syllable_length)</span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> verse_string</span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a><span class="co">#</span><span class="re">END</span><span class="co"> OF VERSE ONE GEN    </span></span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> haiku_gen():</span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> random</span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> GPT2_seed_text</span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> haiku_seed</span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> <span class="bu">open</span>(<span class="st">'sajiki.txt'</span>).read().splitlines()</span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a>    GPT2_seed_text <span class="op">=</span> random.choice(lines)</span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a>    haiku_seed <span class="op">=</span> GPT2_seed_text</span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a>    text_generator(state_dict)</span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a><span class="co">#Code to generate verse 1:</span></span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a>    verse_string <span class="op">=</span> <span class="st">""</span></span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a>    verse_input <span class="op">=</span> GPT2_output</span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a>    syllable_length <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a>    verse_one_string<span class="op">=</span>verse_gen(verse_input, syllable_length)</span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a><span class="co">#Code to generate verse 2:</span></span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a>    verse_string <span class="op">=</span> <span class="st">""</span></span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true" tabindex="-1"></a>    GPT2_seed_text <span class="op">=</span> verse_one_string</span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true" tabindex="-1"></a>    text_generator(state_dict)</span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true" tabindex="-1"></a>    verse_input <span class="op">=</span> GPT2_output</span>
<span id="cb12-131"><a href="#cb12-131" aria-hidden="true" tabindex="-1"></a>    syllable_length <span class="op">=</span> <span class="dv">7</span></span>
<span id="cb12-132"><a href="#cb12-132" aria-hidden="true" tabindex="-1"></a>    verse_two_string<span class="op">=</span>verse_gen(verse_input, syllable_length)</span>
<span id="cb12-133"><a href="#cb12-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-134"><a href="#cb12-134" aria-hidden="true" tabindex="-1"></a><span class="co">#Code to generate verse 3:</span></span>
<span id="cb12-135"><a href="#cb12-135" aria-hidden="true" tabindex="-1"></a>    verse_string <span class="op">=</span> <span class="st">""</span></span>
<span id="cb12-136"><a href="#cb12-136" aria-hidden="true" tabindex="-1"></a>    GPT2_seed_text <span class="op">=</span> verse_one_string</span>
<span id="cb12-137"><a href="#cb12-137" aria-hidden="true" tabindex="-1"></a>    text_generator(state_dict)</span>
<span id="cb12-138"><a href="#cb12-138" aria-hidden="true" tabindex="-1"></a>    verse_input <span class="op">=</span> GPT2_output</span>
<span id="cb12-139"><a href="#cb12-139" aria-hidden="true" tabindex="-1"></a>    syllable_length<span class="op">=</span><span class="dv">5</span></span>
<span id="cb12-140"><a href="#cb12-140" aria-hidden="true" tabindex="-1"></a>    verse_three_string<span class="op">=</span>verse_gen(verse_input, syllable_length)</span>
<span id="cb12-141"><a href="#cb12-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-142"><a href="#cb12-142" aria-hidden="true" tabindex="-1"></a><span class="co">#Print finished haiku</span></span>
<span id="cb12-143"><a href="#cb12-143" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Here is the haiku seed:"</span>)</span>
<span id="cb12-144"><a href="#cb12-144" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(haiku_seed)</span>
<span id="cb12-145"><a href="#cb12-145" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Here is the haiku:"</span>)</span>
<span id="cb12-146"><a href="#cb12-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-147"><a href="#cb12-147" aria-hidden="true" tabindex="-1"></a><span class="co">#Print finished haiku</span></span>
<span id="cb12-148"><a href="#cb12-148" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb12-149"><a href="#cb12-149" aria-hidden="true" tabindex="-1"></a>    finished_haiku<span class="op">=</span><span class="st">''</span></span>
<span id="cb12-150"><a href="#cb12-150" aria-hidden="true" tabindex="-1"></a>    finished_haiku<span class="op">=</span><span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join([verse_one_string,verse_two_string,verse_three_string])</span>
<span id="cb12-151"><a href="#cb12-151" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(finished_haiku)</span>
<span id="cb12-152"><a href="#cb12-152" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-153"><a href="#cb12-153" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Add finished haiku to a list and date</span></span>
<span id="cb12-154"><a href="#cb12-154" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Todo add date and time</span></span>
<span id="cb12-155"><a href="#cb12-155" aria-hidden="true" tabindex="-1"></a>     <span class="co">#import datetime</span></span>
<span id="cb12-156"><a href="#cb12-156" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb12-157"><a href="#cb12-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-158"><a href="#cb12-158" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get current date</span></span>
<span id="cb12-159"><a href="#cb12-159" aria-hidden="true" tabindex="-1"></a>    now <span class="op">=</span> datetime.now()</span>
<span id="cb12-160"><a href="#cb12-160" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-161"><a href="#cb12-161" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert current date into timestamp</span></span>
<span id="cb12-162"><a href="#cb12-162" aria-hidden="true" tabindex="-1"></a>    haiku_time <span class="op">=</span> now.strftime(<span class="st">"%m/</span><span class="sc">%d</span><span class="st">/%Y, %H:%M:%S"</span>)</span>
<span id="cb12-163"><a href="#cb12-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-164"><a href="#cb12-164" aria-hidden="true" tabindex="-1"></a>    f <span class="op">=</span> <span class="bu">open</span>(<span class="st">"haikulist.txt"</span>, <span class="st">"a"</span>)</span>
<span id="cb12-165"><a href="#cb12-165" aria-hidden="true" tabindex="-1"></a>    f.write(<span class="st">"</span><span class="ch">\n\n</span><span class="st">Haiku seed:</span><span class="ch">\n</span><span class="st">"</span><span class="op">+</span>haiku_seed<span class="op">+</span><span class="st">"</span><span class="ch">\n\n</span><span class="st">Haiku:</span><span class="ch">\n</span><span class="st">"</span><span class="op">+</span>finished_haiku<span class="op">+</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span><span class="op">+</span>haiku_time)</span>
<span id="cb12-166"><a href="#cb12-166" aria-hidden="true" tabindex="-1"></a>    f.close()</span>
<span id="cb12-167"><a href="#cb12-167" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-168"><a href="#cb12-168" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Place finished haiku in an input for GUI (clear it out first)</span></span>
<span id="cb12-169"><a href="#cb12-169" aria-hidden="true" tabindex="-1"></a>    f <span class="op">=</span> <span class="bu">open</span>(<span class="st">"latesthaiku.txt"</span>, <span class="st">"w"</span>)</span>
<span id="cb12-170"><a href="#cb12-170" aria-hidden="true" tabindex="-1"></a>    f.write(finished_haiku)</span>
<span id="cb12-171"><a href="#cb12-171" aria-hidden="true" tabindex="-1"></a>    f.close()</span>
<span id="cb12-172"><a href="#cb12-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-173"><a href="#cb12-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-174"><a href="#cb12-174" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Put verse2 in as GPT seedtext seed  ## This leads to too much convergence</span></span>
<span id="cb12-175"><a href="#cb12-175" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-176"><a href="#cb12-176" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  f.write(verse_two_string)</span></span>
<span id="cb12-177"><a href="#cb12-177" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  get sajiki from http://jti.lib.virginia.edu/japanese/haiku/saijiki/full.html  -&gt; sajiki.txt</span></span>
<span id="cb12-178"><a href="#cb12-178" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb12-179"><a href="#cb12-179" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-180"><a href="#cb12-180" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> random</span>
<span id="cb12-181"><a href="#cb12-181" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-182"><a href="#cb12-182" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> IPython.display <span class="im">import</span> Audio</span>
<span id="cb12-183"><a href="#cb12-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-184"><a href="#cb12-184" aria-hidden="true" tabindex="-1"></a>    wave <span class="op">=</span> np.sin(<span class="dv">2</span><span class="op">*</span>np.pi<span class="op">*</span><span class="dv">400</span><span class="op">*</span>np.arange(<span class="dv">10000</span><span class="op">*</span><span class="dv">2</span>)<span class="op">/</span><span class="dv">10000</span>)</span>
<span id="cb12-185"><a href="#cb12-185" aria-hidden="true" tabindex="-1"></a>    Audio(wave, rate<span class="op">=</span><span class="dv">30000</span>, autoplay<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-186"><a href="#cb12-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-187"><a href="#cb12-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-188"><a href="#cb12-188" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-189"><a href="#cb12-189" aria-hidden="true" tabindex="-1"></a><span class="co">##Run the module:</span></span>
<span id="cb12-190"><a href="#cb12-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-191"><a href="#cb12-191" aria-hidden="true" tabindex="-1"></a><span class="co">#Initial arguments go here:</span></span>
<span id="cb12-192"><a href="#cb12-192" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Audio</span>
<span id="cb12-193"><a href="#cb12-193" aria-hidden="true" tabindex="-1"></a>args_nsamples <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb12-194"><a href="#cb12-194" aria-hidden="true" tabindex="-1"></a>args_batch_size <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb12-195"><a href="#cb12-195" aria-hidden="true" tabindex="-1"></a>args_length <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb12-196"><a href="#cb12-196" aria-hidden="true" tabindex="-1"></a>args_unconditional <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-197"><a href="#cb12-197" aria-hidden="true" tabindex="-1"></a>args_temperature <span class="op">=</span> <span class="fl">0.9</span></span>
<span id="cb12-198"><a href="#cb12-198" aria-hidden="true" tabindex="-1"></a>args_top_k <span class="op">=</span> <span class="dv">40</span></span>
<span id="cb12-199"><a href="#cb12-199" aria-hidden="true" tabindex="-1"></a>args_quiet <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb12-200"><a href="#cb12-200" aria-hidden="true" tabindex="-1"></a>verse_input <span class="op">=</span> <span class="st">""</span></span>
<span id="cb12-201"><a href="#cb12-201" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-202"><a href="#cb12-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-203"><a href="#cb12-203" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> z <span class="op">&lt;</span> <span class="dv">100</span>:</span>
<span id="cb12-204"><a href="#cb12-204" aria-hidden="true" tabindex="-1"></a>   <span class="co"># lines = open('sajiki.txt').read().splitlines()</span></span>
<span id="cb12-205"><a href="#cb12-205" aria-hidden="true" tabindex="-1"></a>   <span class="co"># GPT2_seed_text = random.choice(lines)</span></span>
<span id="cb12-206"><a href="#cb12-206" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb12-207"><a href="#cb12-207" aria-hidden="true" tabindex="-1"></a>    haiku_gen()</span>
<span id="cb12-208"><a href="#cb12-208" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-209"><a href="#cb12-209" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-210"><a href="#cb12-210" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Beep after each iteration</span></span>
<span id="cb12-211"><a href="#cb12-211" aria-hidden="true" tabindex="-1"></a>    wave <span class="op">=</span> np.sin(<span class="dv">2</span><span class="op">*</span>np.pi<span class="op">*</span><span class="dv">400</span><span class="op">*</span>np.arange(<span class="dv">10000</span><span class="op">*</span><span class="dv">2</span>)<span class="op">/</span><span class="dv">10000</span>)</span>
<span id="cb12-212"><a href="#cb12-212" aria-hidden="true" tabindex="-1"></a>    Audio(wave, rate<span class="op">=</span><span class="dv">30000</span>, autoplay<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-213"><a href="#cb12-213" aria-hidden="true" tabindex="-1"></a>    z<span class="op">+</span><span class="dv">1</span></span>
<span id="cb12-214"><a href="#cb12-214" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-215"><a href="#cb12-215" aria-hidden="true" tabindex="-1"></a><span class="co">#Beep when all done</span></span>
<span id="cb12-216"><a href="#cb12-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-217"><a href="#cb12-217" aria-hidden="true" tabindex="-1"></a>wave <span class="op">=</span> np.sin(<span class="dv">2</span><span class="op">*</span>np.pi<span class="op">*</span><span class="dv">400</span><span class="op">*</span>np.arange(<span class="dv">10000</span><span class="op">*</span><span class="dv">2</span>)<span class="op">/</span><span class="dv">10000</span>)</span>
<span id="cb12-218"><a href="#cb12-218" aria-hidden="true" tabindex="-1"></a>Audio(wave, rate<span class="op">=</span><span class="dv">40000</span>, autoplay<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-219"><a href="#cb12-219" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Here’s an indicative result of a generated “haiku”:</p>
<div class="code-output">
<p>Haiku seed:</p>
<p>kōri , ice</p>
<p>Haiku:</p>
<p>ice water is<br>
extremely sensitive<br>
But you might want to</p>
</div>
<p>To be clear, most of the results were terrible!</p>
<p>Here are some of the more interesting generations:</p>
<p><em>There will be no<br>
shortage of good things going<br>
have insurance</em></p>
<p><em>Should we be worried<br>
are the implications<br>
taking the first steps</em></p>
<p><em>Lactobacillus<br>
use of a strain as a<br>
A novel species</em></p>
<p>It also generated some real oddballs and many nonsensical results -</p>
<p><em>“The only<br>
now will be my story. My<br>
now is not a good</em></p>
<p><em>which saw the season<br>
premiere of The Mummy<br>
and will likely</em></p>
<p><strong>Asking LLMs for help in 2025</strong></p>
<p>Now, could Claude in 2025 come up with a better solution?</p>
<p>2025 prompt to Sonnet 4.5:</p>
<p><em>I’d like you to use GPT-2 to create a haiku. I’m accessing GPT-2 by using a Jupyter notebook, using the following code. Please build off of this example to make a GPT-2 Haiku generator using Python script that I can run in a Jupyter notebook on my MacBook.</em></p>
<p><em>from transformers import pipeline, set_seed<br>
generator = pipeline(‘text-generation’, model=‘gpt2’)<br>
set_seed(42)<br>
generator(“Hello, I’m a language model,”, max_length=30, num_return_sequences=5)</em></p>
<p>Here’s Sonnet 4.5’s answer:</p>
<div id="bd8be4a0-2a1e-4def-9a31-a90ba207892b" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Cell 1</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GPT-2 Haiku Generator - Jupyter Notebook Version</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy each cell below into separate cells in your Jupyter notebook</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># CELL 1: Install dependencies (if needed)</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Uncomment and run if you need to install transformers</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># !pip install transformers torch</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="e761cb82-9e4f-4193-b0d0-ebdbd738550e" class="cell">
<details class="code-fold">
<summary>Cell 2</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># CELL 2: Import libraries and define functions</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> pipeline, set_seed</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Syllable counting using a simple heuristic</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_syllables(word):</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Count syllables in a word using vowel-counting heuristic."""</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    word <span class="op">=</span> word.lower().strip()</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(word) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    word <span class="op">=</span> re.sub(<span class="vs">r'</span><span class="pp">[^a-z]</span><span class="vs">'</span>, <span class="st">''</span>, word)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    vowels <span class="op">=</span> <span class="st">"aeiouy"</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    syllable_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    previous_was_vowel <span class="op">=</span> <span class="va">False</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> char <span class="kw">in</span> word:</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>        is_vowel <span class="op">=</span> char <span class="kw">in</span> vowels</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> is_vowel <span class="kw">and</span> <span class="kw">not</span> previous_was_vowel:</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>            syllable_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>        previous_was_vowel <span class="op">=</span> is_vowel</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> word.endswith(<span class="st">'e'</span>) <span class="kw">and</span> syllable_count <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>        syllable_count <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> syllable_count <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>        syllable_count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> syllable_count</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_line_syllables(line):</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Count total syllables in a line of text."""</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    words <span class="op">=</span> re.findall(<span class="vs">r'</span><span class="dv">\b</span><span class="pp">[a-zA-Z]</span><span class="op">+</span><span class="dv">\b</span><span class="vs">'</span>, line)</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(count_syllables(word) <span class="cf">for</span> word <span class="kw">in</span> words)</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_haiku_line(generator, prompt, target_syllables, max_attempts<span class="op">=</span><span class="dv">50</span>):</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Generate a line with approximately the target number of syllables."""</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> attempt <span class="kw">in</span> <span class="bu">range</span>(max_attempts):</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> generator(</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>            prompt,</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>            max_length<span class="op">=</span><span class="dv">20</span> <span class="op">+</span> attempt,</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>            num_return_sequences<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>            temperature<span class="op">=</span><span class="fl">0.8</span> <span class="op">+</span> (attempt <span class="op">*</span> <span class="fl">0.02</span>),</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>            do_sample<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>            top_k<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>            top_p<span class="op">=</span><span class="fl">0.95</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>        )[<span class="dv">0</span>][<span class="st">'generated_text'</span>]</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>        generated <span class="op">=</span> output[<span class="bu">len</span>(prompt):].strip()</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>        lines <span class="op">=</span> re.split(<span class="vs">r'</span><span class="pp">[.!?</span><span class="ch">\n</span><span class="pp">]</span><span class="vs">'</span>, generated)</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> lines:</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>            line <span class="op">=</span> lines[<span class="dv">0</span>].strip()</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>            syllables <span class="op">=</span> count_line_syllables(line)</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">abs</span>(syllables <span class="op">-</span> target_syllables) <span class="op">&lt;=</span> <span class="dv">1</span>:</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> line, syllables</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> line, syllables</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_haiku(seed<span class="op">=</span><span class="va">None</span>, theme<span class="op">=</span><span class="st">"nature"</span>):</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Generate a haiku using GPT-2."""</span></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> seed <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>        set_seed(seed)</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>        random.seed(seed)</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>    generator <span class="op">=</span> pipeline(<span class="st">'text-generation'</span>, model<span class="op">=</span><span class="st">'gpt2'</span>)</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>    theme_prompts <span class="op">=</span> {</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nature"</span>: [<span class="st">"The autumn leaves"</span>, <span class="st">"Morning dew on"</span>, <span class="st">"Cherry blossoms"</span>, </span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"The mountain peak"</span>, <span class="st">"Ocean waves crash"</span>],</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>        <span class="st">"seasons"</span>: [<span class="st">"Winter snow falls"</span>, <span class="st">"Spring flowers bloom"</span>, <span class="st">"Summer heat waves"</span>,</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Autumn winds blow"</span>],</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">"zen"</span>: [<span class="st">"Silent meditation"</span>, <span class="st">"Peace surrounds the"</span>, <span class="st">"Quiet temple bell"</span>,</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Moonlight reflection"</span>],</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ocean"</span>: [<span class="st">"The ocean tide"</span>, <span class="st">"Waves upon the"</span>, <span class="st">"Deep blue water"</span>,</span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Coastal sunset"</span>],</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>        <span class="st">"custom"</span>: [theme]</span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> theme <span class="kw">in</span> theme_prompts:</span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>        prompts <span class="op">=</span> theme_prompts[theme]</span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>        prompts <span class="op">=</span> theme_prompts[<span class="st">"custom"</span>]</span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Generating haiku...</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Line 1: 5 syllables</span></span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a>    prompt1 <span class="op">=</span> random.choice(prompts)</span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a>    line1, syl1 <span class="op">=</span> generate_haiku_line(generator, prompt1, <span class="dv">5</span>)</span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Line 1 (</span><span class="sc">{</span>syl1<span class="sc">}</span><span class="ss"> syllables): </span><span class="sc">{</span>line1<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Line 2: 7 syllables</span></span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a>    line2, syl2 <span class="op">=</span> generate_haiku_line(generator, line1 <span class="op">+</span> <span class="st">" "</span>, <span class="dv">7</span>)</span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Line 2 (</span><span class="sc">{</span>syl2<span class="sc">}</span><span class="ss"> syllables): </span><span class="sc">{</span>line2<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Line 3: 5 syllables</span></span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a>    line3, syl3 <span class="op">=</span> generate_haiku_line(generator, line2 <span class="op">+</span> <span class="st">" "</span>, <span class="dv">5</span>)</span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Line 3 (</span><span class="sc">{</span>syl3<span class="sc">}</span><span class="ss"> syllables): </span><span class="sc">{</span>line3<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a>    haiku <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>line1<span class="sc">}</span><span class="ch">\n</span><span class="sc">{</span>line2<span class="sc">}</span><span class="ch">\n</span><span class="sc">{</span>line3<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"GENERATED HAIKU:"</span>)</span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(haiku)</span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Syllable count: </span><span class="sc">{</span>syl1<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>syl2<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>syl3<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-114"><a href="#cb14-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> haiku</span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✅ Functions loaded successfully!"</span>)</span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="abe5160c-800c-4ef6-b8f9-f10f3229d7b4" class="cell">
<details class="code-fold">
<summary>Cell 3</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># CELL 3: Generate a single haiku</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate one haiku with a specific seed</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>haiku <span class="op">=</span> generate_haiku(seed<span class="op">=</span><span class="dv">42</span>, theme<span class="op">=</span><span class="st">"nature"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>==================================================<br>
GENERATED HAIKU:<br>
==================================================<br>
look a bit too nice<br>
to use in any way<br>
in their own life<br>
==================================================<br>
Syllable count: 5-6-4<br>
</p>
<div id="a9ad883e-eda1-4c8e-8ad7-abe8396a3f31" class="cell" data-scrolled="true">
<details class="code-fold">
<summary>Cell 4</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># CELL 4: Generate multiple haikus</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate 3 different haikus</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span><span class="st">'#'</span><span class="op">*</span><span class="dv">50</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"HAIKU #</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'#'</span><span class="op">*</span><span class="dv">50</span><span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    generate_haiku(seed<span class="op">=</span><span class="dv">42</span><span class="op">+</span>i, theme<span class="op">=</span><span class="st">"nature"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>==================================================<br>
GENERATED HAIKU:<br>
==================================================<br>
and the mountains<br>
ʻOlaʻo, but this would not happen<br>
ʻ” in the future<br>
==================================================<br>
Syllable count: 4-6-4<br>
</p>
<div id="65ae3295-9ccb-4e18-9e6d-1005c037d6db" class="cell" data-scrolled="true">
<details class="code-fold">
<summary>Cell 5</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># CELL 5: Try different themes</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Try different themes</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>themes <span class="op">=</span> [<span class="st">"nature"</span>, <span class="st">"seasons"</span>, <span class="st">"zen"</span>, <span class="st">"ocean"</span>]</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> theme <span class="kw">in</span> themes:</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🌸 Theme: </span><span class="sc">{</span>theme<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss"> 🌸"</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    generate_haiku(seed<span class="op">=</span><span class="dv">42</span>, theme<span class="op">=</span>theme)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>==================================================<br>
GENERATED HAIKU:<br>
==================================================<br>
wave and the sun<br>
- or a couple of times<br>
a lot of times<br>
==================================================<br>
Syllable count: 4-6-5<br>
</p>
<div id="495ca6b8-204e-4dbd-9217-61d9af888603" class="cell">
<details class="code-fold">
<summary>Cell 6</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># CELL 6: Custom theme</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Use your own custom starting phrase</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>custom_haiku <span class="op">=</span> generate_haiku(seed<span class="op">=</span><span class="dv">42</span>, theme<span class="op">=</span><span class="st">"The starry night"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>The results have some of the same issues (incoherence), but with fewer bad generations than the original method.</p>
<p>And here’s what Opus 4.1 came up with. It relies more heavily on a set number of stock seed phrases. Opus proposed an “advanced” and “simplified” script; below is the “advanced” version. Unlike Sonnet, Opus did not actually configure the output code for a Jupyter notebook despite claiming to. I’ve left the results below - they’re not great.</p>
<div id="a9506f66-03e2-48ad-9c66-81d9c3aea547" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Opus version code - Part 1</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">GPT-2 Haiku Generator</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">This script uses GPT-2 to generate text and formats it into haikus (5-7-5 syllable structure)</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> pipeline, set_seed</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> syllables  <span class="co"># You'll need to install: pip install syllables</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> GPT2HaikuGenerator:</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, model<span class="op">=</span><span class="st">'gpt2'</span>):</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Initialize the GPT-2 generator"""</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.generator <span class="op">=</span> pipeline(<span class="st">'text-generation'</span>, model<span class="op">=</span>model)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.haiku_prompts <span class="op">=</span> [</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Cherry blossoms"</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Morning dewdrops"</span>,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Autumn leaves fall"</span>,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Winter silence"</span>,</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Summer breeze"</span>,</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Mountains standing"</span>,</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Ocean waves"</span>,</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Moonlight shining"</span>,</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Birds singing"</span>,</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Rain falling"</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> count_syllables(<span class="va">self</span>, word):</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Count syllables in a word using the syllables library"""</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> syllables.estimate(word)</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Fallback: rough estimation if library fails</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">max</span>(<span class="dv">1</span>, <span class="bu">len</span>(re.findall(<span class="vs">r'</span><span class="pp">[aeiouAEIOU]</span><span class="vs">'</span>, word)))</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract_words_with_syllables(<span class="va">self</span>, text, target_syllables):</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Extract words from text that sum to target syllables"""</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>        words <span class="op">=</span> re.findall(<span class="vs">r'</span><span class="dv">\b\w</span><span class="op">+</span><span class="dv">\b</span><span class="vs">'</span>, text)</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> []</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>        current_syllables <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> word <span class="kw">in</span> words:</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>            syllable_count <span class="op">=</span> <span class="va">self</span>.count_syllables(word)</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> current_syllables <span class="op">+</span> syllable_count <span class="op">&lt;=</span> target_syllables:</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>                result.append(word)</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>                current_syllables <span class="op">+=</span> syllable_count</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> current_syllables <span class="op">==</span> target_syllables:</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">' '</span>.join(result), current_syllables</span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> generate_haiku_from_text(<span class="va">self</span>, text):</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Try to format generated text into haiku structure"""</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Clean the text</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> re.sub(<span class="vs">r'</span><span class="pp">[^</span><span class="dv">\w\s</span><span class="pp">]</span><span class="vs">'</span>, <span class="st">''</span>, text)</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>        words <span class="op">=</span> text.split()</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(words) <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try to build haiku lines</span></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>        line1, syll1 <span class="op">=</span> <span class="va">self</span>.extract_words_with_syllables(<span class="st">' '</span>.join(words), <span class="dv">5</span>)</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>        remaining_words <span class="op">=</span> <span class="st">' '</span>.join(words[<span class="bu">len</span>(line1.split()):])</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>        line2, syll2 <span class="op">=</span> <span class="va">self</span>.extract_words_with_syllables(remaining_words, <span class="dv">7</span>)</span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>        remaining_words <span class="op">=</span> <span class="st">' '</span>.join(words[<span class="bu">len</span>(line1.split()) <span class="op">+</span> <span class="bu">len</span>(line2.split()):])</span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>        line3, syll3 <span class="op">=</span> <span class="va">self</span>.extract_words_with_syllables(remaining_words, <span class="dv">5</span>)</span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if we got close enough to proper syllable counts</span></span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="dv">4</span> <span class="op">&lt;=</span> syll1 <span class="op">&lt;=</span> <span class="dv">6</span>) <span class="kw">and</span> (<span class="dv">6</span> <span class="op">&lt;=</span> syll2 <span class="op">&lt;=</span> <span class="dv">8</span>) <span class="kw">and</span> (<span class="dv">4</span> <span class="op">&lt;=</span> syll3 <span class="op">&lt;=</span> <span class="dv">6</span>):</span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>line1<span class="sc">}</span><span class="ch">\n</span><span class="sc">{</span>line2<span class="sc">}</span><span class="ch">\n</span><span class="sc">{</span>line3<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> generate_haiku(<span class="va">self</span>, prompt<span class="op">=</span><span class="va">None</span>, temperature<span class="op">=</span><span class="fl">0.8</span>, max_attempts<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Generate a haiku using GPT-2"""</span></span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> prompt <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>            prompt <span class="op">=</span> random.choice(<span class="va">self</span>.haiku_prompts)</span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>        set_seed(random.randint(<span class="dv">1</span>, <span class="dv">1000</span>))</span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> attempt <span class="kw">in</span> <span class="bu">range</span>(max_attempts):</span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Generate text with GPT-2</span></span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a>            generated <span class="op">=</span> <span class="va">self</span>.generator(</span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a>                prompt,</span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a>                max_length<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a>                num_return_sequences<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a>                temperature<span class="op">=</span>temperature,</span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a>                pad_token_id<span class="op">=</span><span class="dv">50256</span>  <span class="co"># GPT-2's EOS token</span></span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Try to format each generated text as haiku</span></span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> result <span class="kw">in</span> generated:</span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a>                text <span class="op">=</span> result[<span class="st">'generated_text'</span>]</span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Remove the prompt from the beginning</span></span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a>                text <span class="op">=</span> text[<span class="bu">len</span>(prompt):].strip()</span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a>                haiku <span class="op">=</span> <span class="va">self</span>.generate_haiku_from_text(text)</span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> haiku:</span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="ss">f"Prompt: </span><span class="sc">{</span>prompt<span class="sc">}</span><span class="ch">\n\n</span><span class="sc">{</span>haiku<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fallback: return best attempt even if syllables aren't perfect</span></span>
<span id="cb19-104"><a href="#cb19-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.create_simple_haiku(prompt)</span>
<span id="cb19-105"><a href="#cb19-105" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> create_simple_haiku(<span class="va">self</span>, prompt):</span>
<span id="cb19-107"><a href="#cb19-107" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Create a simple haiku by taking first words from generation"""</span></span>
<span id="cb19-108"><a href="#cb19-108" aria-hidden="true" tabindex="-1"></a>        generated <span class="op">=</span> <span class="va">self</span>.generator(prompt, max_length<span class="op">=</span><span class="dv">30</span>, temperature<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb19-109"><a href="#cb19-109" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> generated[<span class="dv">0</span>][<span class="st">'generated_text'</span>][<span class="bu">len</span>(prompt):].strip()</span>
<span id="cb19-110"><a href="#cb19-110" aria-hidden="true" tabindex="-1"></a>        words <span class="op">=</span> re.findall(<span class="vs">r'</span><span class="dv">\b\w</span><span class="op">+</span><span class="dv">\b</span><span class="vs">'</span>, text)</span>
<span id="cb19-111"><a href="#cb19-111" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-112"><a href="#cb19-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(words) <span class="op">&gt;=</span> <span class="dv">7</span>:</span>
<span id="cb19-113"><a href="#cb19-113" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f"Prompt: </span><span class="sc">{</span>prompt<span class="sc">}</span><span class="ch">\n\n</span><span class="sc">{</span><span class="st">' '</span><span class="sc">.</span>join(words[:<span class="dv">2</span>])<span class="sc">}</span><span class="ch">\n</span><span class="sc">{</span><span class="st">' '</span><span class="sc">.</span>join(words[<span class="dv">2</span>:<span class="dv">5</span>])<span class="sc">}</span><span class="ch">\n</span><span class="sc">{</span><span class="st">' '</span><span class="sc">.</span>join(words[<span class="dv">5</span>:<span class="dv">7</span>])<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb19-114"><a href="#cb19-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb19-115"><a href="#cb19-115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f"Prompt: </span><span class="sc">{</span>prompt<span class="sc">}</span><span class="ch">\n\n</span><span class="sc">{</span>prompt<span class="sc">}</span><span class="ch">\n</span><span class="sc">{</span><span class="st">' '</span><span class="sc">.</span>join(words[:<span class="dv">3</span>]) <span class="cf">if</span> <span class="bu">len</span>(words) <span class="op">&gt;=</span> <span class="dv">3</span> <span class="cf">else</span> <span class="st">'whispers softly here'</span><span class="sc">}</span><span class="ch">\n</span><span class="sc">{</span><span class="st">'in the quiet air'</span> <span class="cf">if</span> <span class="bu">len</span>(words) <span class="op">&lt;</span> <span class="dv">5</span> <span class="cf">else</span> <span class="st">' '</span><span class="sc">.</span>join(words[<span class="dv">3</span>:<span class="dv">5</span>])<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb19-116"><a href="#cb19-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-117"><a href="#cb19-117" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage in Jupyter notebook:</span></span>
<span id="cb19-118"><a href="#cb19-118" aria-hidden="true" tabindex="-1"></a><span class="co">#if __name__ == "__main__":</span></span>
<span id="cb19-119"><a href="#cb19-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize the haiku generator</span></span>
<span id="cb19-120"><a href="#cb19-120" aria-hidden="true" tabindex="-1"></a> <span class="co">###  Note - I had to comment out the above since Opus did not actually configure this properly in cells for a Jupyter notebook   </span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="78ea8cdb-867d-46d7-bb2e-25259a2e874f" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Opus version code - Part 2</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>haiku_gen <span class="op">=</span> GPT2HaikuGenerator()</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate haikus with different prompts</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"GPT-2 HAIKU GENERATOR"</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate 5 haikus</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Haiku #</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">20</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    haiku <span class="op">=</span> haiku_gen.generate_haiku()</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(haiku)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate haiku with custom prompt</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Custom Prompt Haiku:"</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">20</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>custom_haiku <span class="op">=</span> haiku_gen.generate_haiku(prompt<span class="op">=</span><span class="st">"The old computer"</span>)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(custom_haiku)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Device set to use mps:0
Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation=True` to explicitly truncate examples to max length. Defaulting to 'longest_first' truncation strategy. If you encode pairs of sequences (GLUE-style) with the tokenizer you can select this strategy more precisely by providing a specific strategy to `truncation`.
Both `max_new_tokens` (=256) and `max_length`(=50) seem to have been set. `max_new_tokens` will take precedence. Please refer to the documentation for more information. (https://huggingface.co/docs/transformers/main/en/main_classes/text_generation)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>==================================================
GPT-2 HAIKU GENERATOR
==================================================

Haiku #1:
--------------------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Both `max_new_tokens` (=256) and `max_length`(=50) seem to have been set. `max_new_tokens` will take precedence. Please refer to the documentation for more information. (https://huggingface.co/docs/transformers/main/en/main_classes/text_generation)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Prompt: Summer breeze

blowing through the sky
made his eyes look up But in
the background the wind


Haiku #2:
--------------------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Both `max_new_tokens` (=256) and `max_length`(=50) seem to have been set. `max_new_tokens` will take precedence. Please refer to the documentation for more information. (https://huggingface.co/docs/transformers/main/en/main_classes/text_generation)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Prompt: Morning dewdrops

c9jpg We have some in
issues in the with the going
pipeline going


Haiku #3:
--------------------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Both `max_new_tokens` (=256) and `max_length`(=50) seem to have been set. `max_new_tokens` will take precedence. Please refer to the documentation for more information. (https://huggingface.co/docs/transformers/main/en/main_classes/text_generation)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Prompt: Ocean waves

Frozen rock is an
unusual thing to see Its
almost like a ghost


Haiku #4:
--------------------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Both `max_new_tokens` (=256) and `max_length`(=50) seem to have been set. `max_new_tokens` will take precedence. Please refer to the documentation for more information. (https://huggingface.co/docs/transformers/main/en/main_classes/text_generation)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Prompt: Morning dewdrops

to show his power
I see youre a little
bit nervous I guess


Haiku #5:
--------------------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Both `max_new_tokens` (=256) and `max_length`(=50) seem to have been set. `max_new_tokens` will take precedence. Please refer to the documentation for more information. (https://huggingface.co/docs/transformers/main/en/main_classes/text_generation)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Prompt: Rain falling

and hitting the ground
But if you look at the you
you cant help but of


Custom Prompt Haiku:
--------------------
Prompt: The old computer

from the 90s Im sure
The new one can handle
even more work The</code></pre>
</div>
</div>
<p><strong>Trying Claude Haiku</strong></p>
<p>And of course, we must also try Claude Haiku! Here’s what Haiku 4.5 comes up with. It also uses a limited set of indicative prompts ([“The forest”, “Morning light”, “Water flows”, “Summer breeze”]) and the results are similar to the other Claude models - not great, and occasionally problematic.</p>
<div id="2ea3af13-38b8-423b-8d36-2b32a4392807" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Claude Haiku 4.5 code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> pipeline, set_seed</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the GPT-2 text generation pipeline</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>generator <span class="op">=</span> pipeline(<span class="st">'text-generation'</span>, model<span class="op">=</span><span class="st">'gpt2'</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>set_seed(<span class="dv">42</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_haiku_text(prompt<span class="op">=</span><span class="st">"The"</span>, max_length<span class="op">=</span><span class="dv">50</span>, num_attempts<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Generate text using GPT-2 and attempt to format it as a haiku.</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co">        prompt (str): Starting text for generation</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co">        max_length (int): Maximum length of generated text</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co">        num_attempts (int): Number of generation attempts to find a good haiku</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co">        str: Formatted haiku (or None if no valid haiku found)</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> attempt <span class="kw">in</span> <span class="bu">range</span>(num_attempts):</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Generate text</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>        generated_text <span class="op">=</span> generator(prompt, max_length<span class="op">=</span>max_length, num_return_sequences<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> generated_text[<span class="dv">0</span>][<span class="st">'generated_text'</span>]</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Clean up text: remove special characters and extra whitespace</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> re.sub(<span class="vs">r'</span><span class="pp">[^</span><span class="dv">\w\s</span><span class="pp">]</span><span class="vs">'</span>, <span class="st">''</span>, text)</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> re.sub(<span class="vs">r'</span><span class="dv">\s</span><span class="op">+</span><span class="vs">'</span>, <span class="st">' '</span>, text).strip()</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Split into words</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>        words <span class="op">=</span> text.split()</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try to create a haiku (5-7-5 syllable structure)</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>        haiku <span class="op">=</span> create_haiku_from_words(words)</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> haiku:</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> haiku</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"Could not generate a valid haiku. Try again!"</span></span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_syllables(word):</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a><span class="co">    Estimate syllable count using a simple heuristic.</span></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a><span class="co">    This is not perfect but works reasonably well for English.</span></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>    word <span class="op">=</span> word.lower()</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>    syllable_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>    vowels <span class="op">=</span> <span class="st">"aeiouy"</span></span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>    previous_was_vowel <span class="op">=</span> <span class="va">False</span></span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> char <span class="kw">in</span> word:</span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>        is_vowel <span class="op">=</span> char <span class="kw">in</span> vowels</span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> is_vowel <span class="kw">and</span> <span class="kw">not</span> previous_was_vowel:</span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a>            syllable_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>        previous_was_vowel <span class="op">=</span> is_vowel</span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adjust for silent 'e'</span></span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> word.endswith(<span class="st">'e'</span>):</span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>        syllable_count <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Words have at least 1 syllable</span></span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> syllable_count <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a>        syllable_count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> syllable_count</span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_haiku_from_words(words):</span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-69"><a href="#cb33-69" aria-hidden="true" tabindex="-1"></a><span class="co">    Create a haiku from a list of words using 5-7-5 syllable structure.</span></span>
<span id="cb33-70"><a href="#cb33-70" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb33-71"><a href="#cb33-71" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb33-72"><a href="#cb33-72" aria-hidden="true" tabindex="-1"></a><span class="co">        str: Formatted haiku, or None if not enough syllables</span></span>
<span id="cb33-73"><a href="#cb33-73" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-74"><a href="#cb33-74" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> [[], [], []]</span>
<span id="cb33-75"><a href="#cb33-75" aria-hidden="true" tabindex="-1"></a>    syllable_counts <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb33-76"><a href="#cb33-76" aria-hidden="true" tabindex="-1"></a>    target_syllables <span class="op">=</span> [<span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">5</span>]</span>
<span id="cb33-77"><a href="#cb33-77" aria-hidden="true" tabindex="-1"></a>    word_index <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb33-78"><a href="#cb33-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-79"><a href="#cb33-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> word_index <span class="op">&lt;</span> <span class="bu">len</span>(words) <span class="kw">and</span> <span class="bu">sum</span>(syllable_counts) <span class="op">&lt;</span> <span class="dv">17</span>:</span>
<span id="cb33-80"><a href="#cb33-80" aria-hidden="true" tabindex="-1"></a>        word <span class="op">=</span> words[word_index]</span>
<span id="cb33-81"><a href="#cb33-81" aria-hidden="true" tabindex="-1"></a>        syllables <span class="op">=</span> count_syllables(word)</span>
<span id="cb33-82"><a href="#cb33-82" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-83"><a href="#cb33-83" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Find which line to add to (cycle through lines)</span></span>
<span id="cb33-84"><a href="#cb33-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> line_num <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb33-85"><a href="#cb33-85" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> syllable_counts[line_num] <span class="op">+</span> syllables <span class="op">&lt;=</span> target_syllables[line_num]:</span>
<span id="cb33-86"><a href="#cb33-86" aria-hidden="true" tabindex="-1"></a>                lines[line_num].append(word)</span>
<span id="cb33-87"><a href="#cb33-87" aria-hidden="true" tabindex="-1"></a>                syllable_counts[line_num] <span class="op">+=</span> syllables</span>
<span id="cb33-88"><a href="#cb33-88" aria-hidden="true" tabindex="-1"></a>                word_index <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb33-89"><a href="#cb33-89" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb33-90"><a href="#cb33-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb33-91"><a href="#cb33-91" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If word doesn't fit anywhere, move to next word</span></span>
<span id="cb33-92"><a href="#cb33-92" aria-hidden="true" tabindex="-1"></a>            word_index <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb33-93"><a href="#cb33-93" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-94"><a href="#cb33-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if we have a valid haiku (5-7-5)</span></span>
<span id="cb33-95"><a href="#cb33-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> syllable_counts <span class="op">==</span> target_syllables <span class="kw">and</span> <span class="bu">all</span>(lines):</span>
<span id="cb33-96"><a href="#cb33-96" aria-hidden="true" tabindex="-1"></a>        haiku <span class="op">=</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join([<span class="st">' '</span>.join(line) <span class="cf">for</span> line <span class="kw">in</span> lines])</span>
<span id="cb33-97"><a href="#cb33-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> haiku</span>
<span id="cb33-98"><a href="#cb33-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-99"><a href="#cb33-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb33-100"><a href="#cb33-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-101"><a href="#cb33-101" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate and display haikus</span></span>
<span id="cb33-102"><a href="#cb33-102" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"GPT-2 Haiku Generator"</span>)</span>
<span id="cb33-103"><a href="#cb33-103" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb33-104"><a href="#cb33-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-105"><a href="#cb33-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate multiple haikus with different prompts</span></span>
<span id="cb33-106"><a href="#cb33-106" aria-hidden="true" tabindex="-1"></a>prompts <span class="op">=</span> [<span class="st">"The forest"</span>, <span class="st">"Morning light"</span>, <span class="st">"Water flows"</span>, <span class="st">"Summer breeze"</span>]</span>
<span id="cb33-107"><a href="#cb33-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-108"><a href="#cb33-108" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, prompt <span class="kw">in</span> <span class="bu">enumerate</span>(prompts, <span class="dv">1</span>):</span>
<span id="cb33-109"><a href="#cb33-109" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Haiku </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss"> (prompt: '</span><span class="sc">{</span>prompt<span class="sc">}</span><span class="ss">'):"</span>)</span>
<span id="cb33-110"><a href="#cb33-110" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb33-111"><a href="#cb33-111" aria-hidden="true" tabindex="-1"></a>    haiku <span class="op">=</span> generate_haiku_text(prompt, max_length<span class="op">=</span><span class="dv">50</span>, num_attempts<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb33-112"><a href="#cb33-112" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(haiku)</span>
<span id="cb33-113"><a href="#cb33-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-114"><a href="#cb33-114" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb33-115"><a href="#cb33-115" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generation complete!"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Device set to use mps:0
Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation=True` to explicitly truncate examples to max length. Defaulting to 'longest_first' truncation strategy. If you encode pairs of sequences (GLUE-style) with the tokenizer you can select this strategy more precisely by providing a specific strategy to `truncation`.
Setting `pad_token_id` to `eos_token_id`:50256 for open-end generation.
Both `max_new_tokens` (=256) and `max_length`(=50) seem to have been set. `max_new_tokens` will take precedence. Please refer to the documentation for more information. (https://huggingface.co/docs/transformers/main/en/main_classes/text_generation)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>GPT-2 Haiku Generator
========================================

Haiku 1 (prompt: 'The forest'):
----------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting `pad_token_id` to `eos_token_id`:50256 for open-end generation.
Both `max_new_tokens` (=256) and `max_length`(=50) seem to have been set. `max_new_tokens` will take precedence. Please refer to the documentation for more information. (https://huggingface.co/docs/transformers/main/en/main_classes/text_generation)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>The forest is with
mostly filled the leaves
of a dead tree and

Haiku 2 (prompt: 'Morning light'):
----------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting `pad_token_id` to `eos_token_id`:50256 for open-end generation.
Both `max_new_tokens` (=256) and `max_length`(=50) seem to have been set. `max_new_tokens` will take precedence. Please refer to the documentation for more information. (https://huggingface.co/docs/transformers/main/en/main_classes/text_generation)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Morning light on the
morning of the 911 attacks
On this day were that

Haiku 3 (prompt: 'Water flows'):
----------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting `pad_token_id` to `eos_token_id`:50256 for open-end generation.
Both `max_new_tokens` (=256) and `max_length`(=50) seem to have been set. `max_new_tokens` will take precedence. Please refer to the documentation for more information. (https://huggingface.co/docs/transformers/main/en/main_classes/text_generation)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Water flows I have
a feeling that when they give
me something they

Haiku 4 (prompt: 'Summer breeze'):
----------------------------------------
Summer breeze Its a
beautiful day he says And
Im sure well see you

========================================
Generation complete!</code></pre>
</div>
</div>
<p><strong>Trying OpenAI </strong></p>
<p>This is ChatGPT 5’s response without turning on “thinking mode” - the prompts it suggests don’t seem ideal for GPT-2.</p>
<div id="05d3f45e-ac46-40ac-af40-6d7b51e3fe41" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>ChatGPT 5 code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import required libraries</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> pipeline, set_seed</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> textwrap</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize GPT-2 text generation pipeline</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>generator <span class="op">=</span> pipeline(<span class="st">'text-generation'</span>, model<span class="op">=</span><span class="st">'gpt2'</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>set_seed(<span class="dv">42</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a list of possible prompts (you can edit or expand this list)</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>prompts <span class="op">=</span> [</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Write a haiku about the changing seasons:"</span>,</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Compose a haiku about solitude:"</span>,</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"A haiku describing dawn in the city:"</span>,</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"A haiku about a cat in the rain:"</span>,</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Write a haiku about stars and silence:"</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper function to generate a haiku</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_haiku(prompt<span class="op">=</span><span class="va">None</span>, temperature<span class="op">=</span><span class="fl">0.9</span>, max_length<span class="op">=</span><span class="dv">40</span>):</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> prompt <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">=</span> random.choice(prompts)</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"🪶 Prompt: </span><span class="sc">{</span>prompt<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate text</span></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> generator(</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>        prompt,</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>        max_length<span class="op">=</span>max_length,</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>        num_return_sequences<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>        temperature<span class="op">=</span>temperature,</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>        pad_token_id<span class="op">=</span><span class="dv">50256</span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>    )[<span class="dv">0</span>][<span class="st">'generated_text'</span>]</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clean and format</span></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> output.replace(prompt, <span class="st">""</span>).strip()</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> text.split(<span class="st">"."</span>)[<span class="dv">0</span>]  <span class="co"># trim at first full stop to keep short</span></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> textwrap.wrap(text, width<span class="op">=</span><span class="dv">25</span>)[:<span class="dv">3</span>]  <span class="co"># 3 lines (approx haiku)</span></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Format result as haiku</span></span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>    haiku <span class="op">=</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(lines)</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"🌸 Generated Haiku:</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(haiku)</span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> haiku</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Device set to use mps:0</code></pre>
</div>
</div>
<div id="0149e779-db4e-4a68-bb09-94a4984c0108" class="cell" data-execution_count="32">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ✨ Generate your first haiku!</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>generate_haiku()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation=True` to explicitly truncate examples to max length. Defaulting to 'longest_first' truncation strategy. If you encode pairs of sequences (GLUE-style) with the tokenizer you can select this strategy more precisely by providing a specific strategy to `truncation`.
Both `max_new_tokens` (=256) and `max_length`(=40) seem to have been set. `max_new_tokens` will take precedence. Please refer to the documentation for more information. (https://huggingface.co/docs/transformers/main/en/main_classes/text_generation)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>🪶 Prompt: Write a haiku about the changing seasons:

🌸 Generated Haiku:

The last of the season
was called "Rome"</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>'The last of the season\nwas called "Rome"'</code></pre>
</div>
</div>
<p><strong>Using ChatGPT 5 in Thinking Mode</strong></p>
<p>The code that thinking mode generated is more complex, and the model even suggested a number of notes and tips to make the haiku more stylistically nuanced. But the code didn’t work.</p>
<div id="322f4cf8-c113-4ad9-a4ad-1d7c4b1ff198" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>ChatGPT 5 code - Thinking mode</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If needed, install deps (uncomment the next line and run once)</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># !pip install --quiet transformers torch regex numpy nltk pronouncing</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> pipeline, set_seed</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re, random, itertools</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Syllable counting helpers (CMUdict + heuristic fallback) ---</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> nltk</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> nltk.corpus <span class="im">import</span> cmudict</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>        _ <span class="op">=</span> cmudict.<span class="bu">dict</span>()</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">LookupError</span>:</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>        nltk.download(<span class="st">"cmudict"</span>)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    CMU <span class="op">=</span> cmudict.<span class="bu">dict</span>()</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>    CMU <span class="op">=</span> {}</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>_vowel_re <span class="op">=</span> re.<span class="bu">compile</span>(<span class="vs">r"</span><span class="pp">[aeiouy]</span><span class="op">+</span><span class="vs">"</span>, re.I)</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _cmu_syllables(word: <span class="bu">str</span>):</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Return min syllables from CMU if available, else None."""</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> word.lower()</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> w <span class="kw">in</span> CMU:</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Count vowel phonemes ending with a digit (stress marks)</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">min</span>(<span class="bu">sum</span>(ch[<span class="op">-</span><span class="dv">1</span>].isdigit() <span class="cf">for</span> ch <span class="kw">in</span> pron) <span class="cf">for</span> pron <span class="kw">in</span> CMU[w])</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _heuristic_syllables(word: <span class="bu">str</span>):</span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Lightweight heuristic when CMUdict lacks the word."""</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> word.lower()</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> re.sub(<span class="vs">r"</span><span class="pp">[^a-z']</span><span class="vs">"</span>, <span class="st">""</span>, w)</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> w:</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Basic vowel group counting</span></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>    syl <span class="op">=</span> <span class="bu">len</span>(_vowel_re.findall(w))</span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Silent 'e' adjustment</span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> w.endswith(<span class="st">"e"</span>) <span class="kw">and</span> syl <span class="op">&gt;</span> <span class="dv">1</span> <span class="kw">and</span> <span class="kw">not</span> re.search(<span class="vs">r"</span><span class="pp">[aeiouy]</span><span class="vs">e</span><span class="dv">$</span><span class="vs">"</span>, w):</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>        syl <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Some common endings</span></span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> w.endswith((<span class="st">"le"</span>,<span class="st">"les"</span>)) <span class="kw">and</span> <span class="kw">not</span> re.search(<span class="vs">r"</span><span class="pp">[aeiouy]</span><span class="vs">le</span><span class="op">?</span><span class="vs">s</span><span class="op">?</span><span class="dv">$</span><span class="vs">"</span>, w[:<span class="op">-</span><span class="dv">2</span>]):</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>        syl <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">max</span>(<span class="dv">1</span>, syl)</span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_syllables(text: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> raw <span class="kw">in</span> re.findall(<span class="vs">r"</span><span class="pp">[A-Za-z']</span><span class="op">+</span><span class="vs">"</span>, text):</span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>        cmu <span class="op">=</span> _cmu_syllables(raw)</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> cmu <span class="cf">if</span> cmu <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> _heuristic_syllables(raw)</span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> total</span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Haiku validation ---</span></span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_haiku(lines):</span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Check 5-7-5 syllable pattern and basic cleanliness."""</span></span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(lines) <span class="op">!=</span> <span class="dv">3</span>:</span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a>    targets <span class="op">=</span> [<span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">5</span>]</span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> line, tgt <span class="kw">in</span> <span class="bu">zip</span>(lines, targets):</span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> count_syllables(line)</span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> s <span class="op">!=</span> tgt:</span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Avoid lines that are just punctuation or empties</span></span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> re.search(<span class="vs">r"</span><span class="pp">[A-Za-z]</span><span class="vs">"</span>, line):</span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb48-66"><a href="#cb48-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb48-67"><a href="#cb48-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-68"><a href="#cb48-68" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Build the GPT-2 generator (your base example, expanded) ---</span></span>
<span id="cb48-69"><a href="#cb48-69" aria-hidden="true" tabindex="-1"></a>set_seed(<span class="dv">42</span>)</span>
<span id="cb48-70"><a href="#cb48-70" aria-hidden="true" tabindex="-1"></a>generator <span class="op">=</span> pipeline(<span class="st">"text-generation"</span>, model<span class="op">=</span><span class="st">"gpt2"</span>)  <span class="co"># can swap to "gpt2-medium" if you like</span></span>
<span id="cb48-71"><a href="#cb48-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-72"><a href="#cb48-72" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Prompt &amp; sampling strategy ---</span></span>
<span id="cb48-73"><a href="#cb48-73" aria-hidden="true" tabindex="-1"></a>SYSTEM_PROMPT <span class="op">=</span> (</span>
<span id="cb48-74"><a href="#cb48-74" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Write three short poetic lines separated by newlines.</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb48-75"><a href="#cb48-75" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Avoid rhyming schemes. Natural imagery is welcome.</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb48-76"><a href="#cb48-76" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Keep each line concise and evocative.</span><span class="ch">\n\n</span><span class="st">"</span></span>
<span id="cb48-77"><a href="#cb48-77" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Lines:</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb48-78"><a href="#cb48-78" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-79"><a href="#cb48-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-80"><a href="#cb48-80" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sample_lines(n_candidates<span class="op">=</span><span class="dv">100</span>, temperature<span class="op">=</span><span class="fl">0.9</span>, top_p<span class="op">=</span><span class="fl">0.95</span>, max_new_tokens<span class="op">=</span><span class="dv">40</span>):</span>
<span id="cb48-81"><a href="#cb48-81" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb48-82"><a href="#cb48-82" aria-hidden="true" tabindex="-1"></a><span class="co">    Ask GPT-2 for short three-line snippets and yield candidate line triplets.</span></span>
<span id="cb48-83"><a href="#cb48-83" aria-hidden="true" tabindex="-1"></a><span class="co">    We generate multiple short samples per call to find valid 5-7-5s.</span></span>
<span id="cb48-84"><a href="#cb48-84" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb48-85"><a href="#cb48-85" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> generator(</span>
<span id="cb48-86"><a href="#cb48-86" aria-hidden="true" tabindex="-1"></a>        SYSTEM_PROMPT,</span>
<span id="cb48-87"><a href="#cb48-87" aria-hidden="true" tabindex="-1"></a>        do_sample<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb48-88"><a href="#cb48-88" aria-hidden="true" tabindex="-1"></a>        temperature<span class="op">=</span>temperature,</span>
<span id="cb48-89"><a href="#cb48-89" aria-hidden="true" tabindex="-1"></a>        top_p<span class="op">=</span>top_p,</span>
<span id="cb48-90"><a href="#cb48-90" aria-hidden="true" tabindex="-1"></a>        max_new_tokens<span class="op">=</span>max_new_tokens,</span>
<span id="cb48-91"><a href="#cb48-91" aria-hidden="true" tabindex="-1"></a>        num_return_sequences<span class="op">=</span>n_candidates,</span>
<span id="cb48-92"><a href="#cb48-92" aria-hidden="true" tabindex="-1"></a>        pad_token_id<span class="op">=</span><span class="dv">50256</span>,   <span class="co"># GPT-2's EOS</span></span>
<span id="cb48-93"><a href="#cb48-93" aria-hidden="true" tabindex="-1"></a>        eos_token_id<span class="op">=</span><span class="dv">50256</span>,</span>
<span id="cb48-94"><a href="#cb48-94" aria-hidden="true" tabindex="-1"></a>        repetition_penalty<span class="op">=</span><span class="fl">1.05</span>,</span>
<span id="cb48-95"><a href="#cb48-95" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb48-96"><a href="#cb48-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> obj <span class="kw">in</span> out:</span>
<span id="cb48-97"><a href="#cb48-97" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Take only the portion after "Lines:" to the first blank line or EOS</span></span>
<span id="cb48-98"><a href="#cb48-98" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> obj[<span class="st">"generated_text"</span>]</span>
<span id="cb48-99"><a href="#cb48-99" aria-hidden="true" tabindex="-1"></a>        after <span class="op">=</span> text.split(<span class="st">"Lines:"</span>, <span class="dv">1</span>)[<span class="op">-</span><span class="dv">1</span>].strip()</span>
<span id="cb48-100"><a href="#cb48-100" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Keep just the first 3 non-empty lines</span></span>
<span id="cb48-101"><a href="#cb48-101" aria-hidden="true" tabindex="-1"></a>        lines <span class="op">=</span> [ln.strip(<span class="st">" -*</span><span class="ch">\t</span><span class="st">"</span>) <span class="cf">for</span> ln <span class="kw">in</span> after.splitlines() <span class="cf">if</span> ln.strip()]</span>
<span id="cb48-102"><a href="#cb48-102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(lines) <span class="op">&gt;=</span> <span class="dv">3</span>:</span>
<span id="cb48-103"><a href="#cb48-103" aria-hidden="true" tabindex="-1"></a>            <span class="cf">yield</span> lines[:<span class="dv">3</span>]</span>
<span id="cb48-104"><a href="#cb48-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-105"><a href="#cb48-105" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_haiku(</span>
<span id="cb48-106"><a href="#cb48-106" aria-hidden="true" tabindex="-1"></a>    attempts<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb48-107"><a href="#cb48-107" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">80</span>,</span>
<span id="cb48-108"><a href="#cb48-108" aria-hidden="true" tabindex="-1"></a>    temperature<span class="op">=</span><span class="fl">0.9</span>,</span>
<span id="cb48-109"><a href="#cb48-109" aria-hidden="true" tabindex="-1"></a>    top_p<span class="op">=</span><span class="fl">0.95</span>,</span>
<span id="cb48-110"><a href="#cb48-110" aria-hidden="true" tabindex="-1"></a>    dedupe<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb48-111"><a href="#cb48-111" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb48-112"><a href="#cb48-112" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb48-113"><a href="#cb48-113" aria-hidden="true" tabindex="-1"></a><span class="co">    Try several batches until a valid 5-7-5 haiku is found.</span></span>
<span id="cb48-114"><a href="#cb48-114" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns a list of candidate haiku (each is a list of 3 lines).</span></span>
<span id="cb48-115"><a href="#cb48-115" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb48-116"><a href="#cb48-116" aria-hidden="true" tabindex="-1"></a>    seen <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb48-117"><a href="#cb48-117" aria-hidden="true" tabindex="-1"></a>    candidates <span class="op">=</span> []</span>
<span id="cb48-118"><a href="#cb48-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(attempts):</span>
<span id="cb48-119"><a href="#cb48-119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> lines <span class="kw">in</span> sample_lines(</span>
<span id="cb48-120"><a href="#cb48-120" aria-hidden="true" tabindex="-1"></a>            n_candidates<span class="op">=</span>batch_size, temperature<span class="op">=</span>temperature, top_p<span class="op">=</span>top_p</span>
<span id="cb48-121"><a href="#cb48-121" aria-hidden="true" tabindex="-1"></a>        ):</span>
<span id="cb48-122"><a href="#cb48-122" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Clean trailing punctuation-only tokens</span></span>
<span id="cb48-123"><a href="#cb48-123" aria-hidden="true" tabindex="-1"></a>            lines <span class="op">=</span> [re.sub(<span class="vs">r"</span><span class="dv">\s</span><span class="op">+</span><span class="vs">"</span>, <span class="st">" "</span>, ln).strip() <span class="cf">for</span> ln <span class="kw">in</span> lines]</span>
<span id="cb48-124"><a href="#cb48-124" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> dedupe:</span>
<span id="cb48-125"><a href="#cb48-125" aria-hidden="true" tabindex="-1"></a>                key <span class="op">=</span> <span class="st">" | "</span>.join(lines).lower()</span>
<span id="cb48-126"><a href="#cb48-126" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> key <span class="kw">in</span> seen:</span>
<span id="cb48-127"><a href="#cb48-127" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb48-128"><a href="#cb48-128" aria-hidden="true" tabindex="-1"></a>                seen.add(key)</span>
<span id="cb48-129"><a href="#cb48-129" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> is_haiku(lines):</span>
<span id="cb48-130"><a href="#cb48-130" aria-hidden="true" tabindex="-1"></a>                candidates.append(lines)</span>
<span id="cb48-131"><a href="#cb48-131" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> candidates:</span>
<span id="cb48-132"><a href="#cb48-132" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb48-133"><a href="#cb48-133" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Slightly anneal temperature if nothing matched yet</span></span>
<span id="cb48-134"><a href="#cb48-134" aria-hidden="true" tabindex="-1"></a>        temperature <span class="op">=</span> <span class="bu">max</span>(<span class="fl">0.7</span>, temperature <span class="op">-</span> <span class="fl">0.05</span>)</span>
<span id="cb48-135"><a href="#cb48-135" aria-hidden="true" tabindex="-1"></a>        top_p <span class="op">=</span> <span class="bu">min</span>(<span class="fl">0.98</span>, top_p <span class="op">+</span> <span class="fl">0.01</span>)</span>
<span id="cb48-136"><a href="#cb48-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> candidates</span>
<span id="cb48-137"><a href="#cb48-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-138"><a href="#cb48-138" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Run it: generate one or more haiku ---</span></span>
<span id="cb48-139"><a href="#cb48-139" aria-hidden="true" tabindex="-1"></a>haikus <span class="op">=</span> generate_haiku(attempts<span class="op">=</span><span class="dv">10</span>, batch_size<span class="op">=</span><span class="dv">100</span>)   </span>
<span id="cb48-140"><a href="#cb48-140" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> haikus:</span>
<span id="cb48-141"><a href="#cb48-141" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"No strict 5-7-5 found this round. Try re-running the cell or raise batch_size."</span>)</span>
<span id="cb48-142"><a href="#cb48-142" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb48-143"><a href="#cb48-143" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, h <span class="kw">in</span> <span class="bu">enumerate</span>(haikus[:<span class="dv">5</span>], <span class="dv">1</span>):</span>
<span id="cb48-144"><a href="#cb48-144" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Haiku </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">:</span><span class="ch">\n</span><span class="ss">"</span> <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(h))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Device set to use mps:0</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>No strict 5-7-5 found this round. Try re-running the cell or raise batch_size.</code></pre>
</div>
</div>
<p>First an error message resulted- “No strict 5-7-5 found this round. Try re-running the cell or raise batch_size.” The next attempt resulted in an out of memory error! I don’t think this approach would have been effective on the Jetson Nano.</p>
<p><strong>Asking Claude to prompt engineer</strong></p>
<p>In this example, I explicitly prompted Sonnet 4.5 to ask for code to generate novel haikus while keeping the limitations of GPT-2 in mind. Sonnet 4.5’s response was few-shot prompting. The results were better than the previous strategies. Below is Claude’s explanation, the code, and the results.</p>
<div class="claude-output">
<p><em>I’ll create a GPT-2 haiku generator with a novel prompting strategy that works around GPT-2’s limitations. The key insight is that GPT-2 works better with concrete examples and structured patterns, so I’ll use few-shot prompting with carefully crafted haiku examples.</em></p>
</div>
<div id="e97cc486-0a56-46e4-9305-a5d838f0aa9b" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Sonnet 4.5 code - revised prompt</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GPT-2 Haiku Generator for Jupyter Notebook</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Run each cell in order</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cell 1: Import and Setup</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> pipeline, set_seed</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize GPT-2</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Loading GPT-2 model..."</span>)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>generator <span class="op">=</span> pipeline(<span class="st">'text-generation'</span>, model<span class="op">=</span><span class="st">'gpt2'</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Model loaded successfully!"</span>)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Cell 2: Helper Functions</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_syllables(word):</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Approximate syllable counter"""</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    word <span class="op">=</span> word.lower().strip()</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(word) <span class="op">&lt;=</span> <span class="dv">3</span>:</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>    vowels <span class="op">=</span> <span class="st">"aeiouy"</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>    syllable_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>    previous_was_vowel <span class="op">=</span> <span class="va">False</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> char <span class="kw">in</span> word:</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>        is_vowel <span class="op">=</span> char <span class="kw">in</span> vowels</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> is_vowel <span class="kw">and</span> <span class="kw">not</span> previous_was_vowel:</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>            syllable_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>        previous_was_vowel <span class="op">=</span> is_vowel</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> word.endswith(<span class="st">'e'</span>):</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>        syllable_count <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> word.endswith(<span class="st">'le'</span>) <span class="kw">and</span> <span class="bu">len</span>(word) <span class="op">&gt;</span> <span class="dv">2</span> <span class="kw">and</span> word[<span class="op">-</span><span class="dv">3</span>] <span class="kw">not</span> <span class="kw">in</span> vowels:</span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>        syllable_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">max</span>(<span class="dv">1</span>, syllable_count)</span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_line_syllables(line):</span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Count syllables in a line"""</span></span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a>    words <span class="op">=</span> re.findall(<span class="vs">r'</span><span class="dv">\b</span><span class="pp">[a-z]</span><span class="op">+</span><span class="dv">\b</span><span class="vs">'</span>, line.lower())</span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(count_syllables(word) <span class="cf">for</span> word <span class="kw">in</span> words)</span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Cell 3: Prompting Strategy</span></span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_haiku_prompt(theme<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a><span class="co">    Novel Prompting Strategy:</span></span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a><span class="co">    - Use few-shot learning with 2 example haikus</span></span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provide clear structure with "Haiku:" labels</span></span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a><span class="co">    - Leave incomplete to trigger completion</span></span>
<span id="cb51-50"><a href="#cb51-50" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb51-51"><a href="#cb51-51" aria-hidden="true" tabindex="-1"></a>    examples <span class="op">=</span> [</span>
<span id="cb51-52"><a href="#cb51-52" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"spring"</span>, <span class="st">"Cherry blossoms fall</span><span class="ch">\n</span><span class="st">Petals dance on gentle wind</span><span class="ch">\n</span><span class="st">Spring whispers softly"</span>),</span>
<span id="cb51-53"><a href="#cb51-53" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"ocean"</span>, <span class="st">"Waves crash on the shore</span><span class="ch">\n</span><span class="st">Salty spray touches my face</span><span class="ch">\n</span><span class="st">Ocean breathes deeply"</span>),</span>
<span id="cb51-54"><a href="#cb51-54" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"winter"</span>, <span class="st">"Snow blankets the ground</span><span class="ch">\n</span><span class="st">Silence wraps the frozen world</span><span class="ch">\n</span><span class="st">Winter dreams in white"</span>),</span>
<span id="cb51-55"><a href="#cb51-55" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"night"</span>, <span class="st">"Moon rises slowly</span><span class="ch">\n</span><span class="st">Stars shimmer in velvet sky</span><span class="ch">\n</span><span class="st">Night embraces earth"</span>),</span>
<span id="cb51-56"><a href="#cb51-56" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"autumn"</span>, <span class="st">"Leaves turn gold and red</span><span class="ch">\n</span><span class="st">Crisp air brings change to the trees</span><span class="ch">\n</span><span class="st">Autumn paints the world"</span>),</span>
<span id="cb51-57"><a href="#cb51-57" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb51-58"><a href="#cb51-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-59"><a href="#cb51-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select relevant examples</span></span>
<span id="cb51-60"><a href="#cb51-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> theme <span class="kw">and</span> <span class="bu">any</span>(theme.lower() <span class="kw">in</span> ex[<span class="dv">0</span>] <span class="cf">for</span> ex <span class="kw">in</span> examples):</span>
<span id="cb51-61"><a href="#cb51-61" aria-hidden="true" tabindex="-1"></a>        selected <span class="op">=</span> [ex <span class="cf">for</span> ex <span class="kw">in</span> examples <span class="cf">if</span> theme.lower() <span class="kw">in</span> ex[<span class="dv">0</span>]][<span class="dv">0</span>]</span>
<span id="cb51-62"><a href="#cb51-62" aria-hidden="true" tabindex="-1"></a>        other_examples <span class="op">=</span> [ex <span class="cf">for</span> ex <span class="kw">in</span> examples <span class="cf">if</span> ex <span class="op">!=</span> selected]</span>
<span id="cb51-63"><a href="#cb51-63" aria-hidden="true" tabindex="-1"></a>        prompt_examples <span class="op">=</span> [selected] <span class="op">+</span> random.sample(other_examples, <span class="dv">1</span>)</span>
<span id="cb51-64"><a href="#cb51-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb51-65"><a href="#cb51-65" aria-hidden="true" tabindex="-1"></a>        prompt_examples <span class="op">=</span> random.sample(examples, <span class="dv">2</span>)</span>
<span id="cb51-66"><a href="#cb51-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-67"><a href="#cb51-67" aria-hidden="true" tabindex="-1"></a>    prompt <span class="op">=</span> <span class="st">"Here are beautiful haikus:</span><span class="ch">\n\n</span><span class="st">"</span></span>
<span id="cb51-68"><a href="#cb51-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> theme_name, haiku <span class="kw">in</span> prompt_examples:</span>
<span id="cb51-69"><a href="#cb51-69" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">+=</span> <span class="ss">f"Haiku:</span><span class="ch">\n</span><span class="sc">{</span>haiku<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">"</span></span>
<span id="cb51-70"><a href="#cb51-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-71"><a href="#cb51-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> theme:</span>
<span id="cb51-72"><a href="#cb51-72" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">+=</span> <span class="ss">f"Haiku about </span><span class="sc">{</span>theme<span class="sc">}</span><span class="ss">:</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb51-73"><a href="#cb51-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb51-74"><a href="#cb51-74" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">+=</span> <span class="st">"Haiku:</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb51-75"><a href="#cb51-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-76"><a href="#cb51-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> prompt</span>
<span id="cb51-77"><a href="#cb51-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-78"><a href="#cb51-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Cell 4: Extraction and Validation</span></span>
<span id="cb51-79"><a href="#cb51-79" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_haiku_from_output(text, max_lines<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb51-80"><a href="#cb51-80" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Extract potential haiku lines"""</span></span>
<span id="cb51-81"><a href="#cb51-81" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> text.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb51-82"><a href="#cb51-82" aria-hidden="true" tabindex="-1"></a>    haiku_candidates <span class="op">=</span> []</span>
<span id="cb51-83"><a href="#cb51-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-84"><a href="#cb51-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> line <span class="kw">in</span> lines[:max_lines]:</span>
<span id="cb51-85"><a href="#cb51-85" aria-hidden="true" tabindex="-1"></a>        line <span class="op">=</span> line.strip()</span>
<span id="cb51-86"><a href="#cb51-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> line <span class="kw">or</span> <span class="bu">len</span>(line) <span class="op">&gt;</span> <span class="dv">60</span> <span class="kw">or</span> line.startswith(<span class="st">'Haiku'</span>):</span>
<span id="cb51-87"><a href="#cb51-87" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb51-88"><a href="#cb51-88" aria-hidden="true" tabindex="-1"></a>        haiku_candidates.append(line)</span>
<span id="cb51-89"><a href="#cb51-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-90"><a href="#cb51-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> haiku_candidates</span>
<span id="cb51-91"><a href="#cb51-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-92"><a href="#cb51-92" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_best_haiku(candidates):</span>
<span id="cb51-93"><a href="#cb51-93" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Find best 5-7-5 pattern"""</span></span>
<span id="cb51-94"><a href="#cb51-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(candidates) <span class="op">&lt;</span> <span class="dv">3</span>:</span>
<span id="cb51-95"><a href="#cb51-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb51-96"><a href="#cb51-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-97"><a href="#cb51-97" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(candidates) <span class="op">-</span> <span class="dv">2</span>):</span>
<span id="cb51-98"><a href="#cb51-98" aria-hidden="true" tabindex="-1"></a>        line1, line2, line3 <span class="op">=</span> candidates[i:i<span class="op">+</span><span class="dv">3</span>]</span>
<span id="cb51-99"><a href="#cb51-99" aria-hidden="true" tabindex="-1"></a>        syl1 <span class="op">=</span> count_line_syllables(line1)</span>
<span id="cb51-100"><a href="#cb51-100" aria-hidden="true" tabindex="-1"></a>        syl2 <span class="op">=</span> count_line_syllables(line2)</span>
<span id="cb51-101"><a href="#cb51-101" aria-hidden="true" tabindex="-1"></a>        syl3 <span class="op">=</span> count_line_syllables(line3)</span>
<span id="cb51-102"><a href="#cb51-102" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-103"><a href="#cb51-103" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept if close to 5-7-5 (within 1 syllable)</span></span>
<span id="cb51-104"><a href="#cb51-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="dv">4</span> <span class="op">&lt;=</span> syl1 <span class="op">&lt;=</span> <span class="dv">6</span> <span class="kw">and</span> <span class="dv">6</span> <span class="op">&lt;=</span> syl2 <span class="op">&lt;=</span> <span class="dv">8</span> <span class="kw">and</span> <span class="dv">4</span> <span class="op">&lt;=</span> syl3 <span class="op">&lt;=</span> <span class="dv">6</span>):</span>
<span id="cb51-105"><a href="#cb51-105" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> (line1, line2, line3, syl1, syl2, syl3)</span>
<span id="cb51-106"><a href="#cb51-106" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-107"><a href="#cb51-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb51-108"><a href="#cb51-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-109"><a href="#cb51-109" aria-hidden="true" tabindex="-1"></a><span class="co"># Cell 5: Main Generator Function</span></span>
<span id="cb51-110"><a href="#cb51-110" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_haiku(theme<span class="op">=</span><span class="va">None</span>, seed<span class="op">=</span><span class="va">None</span>, num_attempts<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb51-111"><a href="#cb51-111" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Generate a haiku with multiple attempts"""</span></span>
<span id="cb51-112"><a href="#cb51-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> seed <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb51-113"><a href="#cb51-113" aria-hidden="true" tabindex="-1"></a>        set_seed(seed)</span>
<span id="cb51-114"><a href="#cb51-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-115"><a href="#cb51-115" aria-hidden="true" tabindex="-1"></a>    best_result <span class="op">=</span> <span class="va">None</span></span>
<span id="cb51-116"><a href="#cb51-116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-117"><a href="#cb51-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> attempt <span class="kw">in</span> <span class="bu">range</span>(num_attempts):</span>
<span id="cb51-118"><a href="#cb51-118" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">=</span> create_haiku_prompt(theme)</span>
<span id="cb51-119"><a href="#cb51-119" aria-hidden="true" tabindex="-1"></a>        temperature <span class="op">=</span> <span class="fl">0.7</span> <span class="op">+</span> (attempt <span class="op">*</span> <span class="fl">0.1</span>)</span>
<span id="cb51-120"><a href="#cb51-120" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-121"><a href="#cb51-121" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> generator(</span>
<span id="cb51-122"><a href="#cb51-122" aria-hidden="true" tabindex="-1"></a>            prompt,</span>
<span id="cb51-123"><a href="#cb51-123" aria-hidden="true" tabindex="-1"></a>            max_new_tokens<span class="op">=</span><span class="dv">50</span>,  <span class="co"># Generate up to 50 new tokens after the prompt;</span></span>
<span id="cb51-124"><a href="#cb51-124" aria-hidden="true" tabindex="-1"></a>            num_return_sequences<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb51-125"><a href="#cb51-125" aria-hidden="true" tabindex="-1"></a>            temperature<span class="op">=</span>temperature,</span>
<span id="cb51-126"><a href="#cb51-126" aria-hidden="true" tabindex="-1"></a>            top_p<span class="op">=</span><span class="fl">0.9</span>,</span>
<span id="cb51-127"><a href="#cb51-127" aria-hidden="true" tabindex="-1"></a>            do_sample<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb51-128"><a href="#cb51-128" aria-hidden="true" tabindex="-1"></a>            pad_token_id<span class="op">=</span><span class="dv">50256</span></span>
<span id="cb51-129"><a href="#cb51-129" aria-hidden="true" tabindex="-1"></a>        )[<span class="dv">0</span>][<span class="st">'generated_text'</span>]</span>
<span id="cb51-130"><a href="#cb51-130" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-131"><a href="#cb51-131" aria-hidden="true" tabindex="-1"></a>        generated <span class="op">=</span> output[<span class="bu">len</span>(prompt):]</span>
<span id="cb51-132"><a href="#cb51-132" aria-hidden="true" tabindex="-1"></a>        candidates <span class="op">=</span> extract_haiku_from_output(generated)</span>
<span id="cb51-133"><a href="#cb51-133" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> find_best_haiku(candidates)</span>
<span id="cb51-134"><a href="#cb51-134" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-135"><a href="#cb51-135" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> result:</span>
<span id="cb51-136"><a href="#cb51-136" aria-hidden="true" tabindex="-1"></a>            line1, line2, line3, syl1, syl2, syl3 <span class="op">=</span> result</span>
<span id="cb51-137"><a href="#cb51-137" aria-hidden="true" tabindex="-1"></a>            score <span class="op">=</span> <span class="bu">abs</span>(<span class="dv">5</span> <span class="op">-</span> syl1) <span class="op">+</span> <span class="bu">abs</span>(<span class="dv">7</span> <span class="op">-</span> syl2) <span class="op">+</span> <span class="bu">abs</span>(<span class="dv">5</span> <span class="op">-</span> syl3)</span>
<span id="cb51-138"><a href="#cb51-138" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb51-139"><a href="#cb51-139" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> best_result <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> score <span class="op">&lt;</span> best_result[<span class="st">'score'</span>]:</span>
<span id="cb51-140"><a href="#cb51-140" aria-hidden="true" tabindex="-1"></a>                best_result <span class="op">=</span> {</span>
<span id="cb51-141"><a href="#cb51-141" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'haiku'</span>: <span class="ss">f"</span><span class="sc">{</span>line1<span class="sc">}</span><span class="ch">\n</span><span class="sc">{</span>line2<span class="sc">}</span><span class="ch">\n</span><span class="sc">{</span>line3<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb51-142"><a href="#cb51-142" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'syllables'</span>: <span class="ss">f"</span><span class="sc">{</span>syl1<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>syl2<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>syl3<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb51-143"><a href="#cb51-143" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'score'</span>: score,</span>
<span id="cb51-144"><a href="#cb51-144" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'attempt'</span>: attempt <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb51-145"><a href="#cb51-145" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb51-146"><a href="#cb51-146" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb51-147"><a href="#cb51-147" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> score <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb51-148"><a href="#cb51-148" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb51-149"><a href="#cb51-149" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-150"><a href="#cb51-150" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_result</span>
<span id="cb51-151"><a href="#cb51-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-152"><a href="#cb51-152" aria-hidden="true" tabindex="-1"></a><span class="co"># Cell 6: Generate a Single Haiku</span></span>
<span id="cb51-153"><a href="#cb51-153" aria-hidden="true" tabindex="-1"></a><span class="co"># Try different themes: "mountain", "rain", "fire", "sunset", "river", etc.</span></span>
<span id="cb51-154"><a href="#cb51-154" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> generate_haiku(theme<span class="op">=</span><span class="st">"mountain"</span>, seed<span class="op">=</span><span class="dv">42</span>, num_attempts<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb51-155"><a href="#cb51-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-156"><a href="#cb51-156" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> result:</span>
<span id="cb51-157"><a href="#cb51-157" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Generated Haiku (Pattern: </span><span class="sc">{</span>result[<span class="st">'syllables'</span>]<span class="sc">}</span><span class="ss">):</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb51-158"><a href="#cb51-158" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(result[<span class="st">'haiku'</span>])</span>
<span id="cb51-159"><a href="#cb51-159" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">(Found on attempt </span><span class="sc">{</span>result[<span class="st">'attempt'</span>]<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb51-160"><a href="#cb51-160" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb51-161"><a href="#cb51-161" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Couldn't generate a valid haiku. Try running the cell again!"</span>)</span>
<span id="cb51-162"><a href="#cb51-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-163"><a href="#cb51-163" aria-hidden="true" tabindex="-1"></a><span class="co"># Cell 7: Generate Multiple Haikus (Optional)</span></span>
<span id="cb51-164"><a href="#cb51-164" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_multiple_haikus(theme<span class="op">=</span><span class="va">None</span>, count<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb51-165"><a href="#cb51-165" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Generate multiple haikus"""</span></span>
<span id="cb51-166"><a href="#cb51-166" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Generating </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss"> haikus"</span> <span class="op">+</span> (<span class="ss">f" about '</span><span class="sc">{</span>theme<span class="sc">}</span><span class="ss">'"</span> <span class="cf">if</span> theme <span class="cf">else</span> <span class="st">""</span>) <span class="op">+</span> <span class="st">"...</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb51-167"><a href="#cb51-167" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-168"><a href="#cb51-168" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(count):</span>
<span id="cb51-169"><a href="#cb51-169" aria-hidden="true" tabindex="-1"></a>        seed <span class="op">=</span> random.randint(<span class="dv">1</span>, <span class="dv">10000</span>)</span>
<span id="cb51-170"><a href="#cb51-170" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> generate_haiku(theme<span class="op">=</span>theme, seed<span class="op">=</span>seed, num_attempts<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb51-171"><a href="#cb51-171" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-172"><a href="#cb51-172" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> result:</span>
<span id="cb51-173"><a href="#cb51-173" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Haiku #</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>result[<span class="st">'syllables'</span>]<span class="sc">}</span><span class="ss">):"</span>)</span>
<span id="cb51-174"><a href="#cb51-174" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(result[<span class="st">'haiku'</span>])</span>
<span id="cb51-175"><a href="#cb51-175" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>()</span>
<span id="cb51-176"><a href="#cb51-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-177"><a href="#cb51-177" aria-hidden="true" tabindex="-1"></a><span class="co"># Run this to generate multiple haikus</span></span>
<span id="cb51-178"><a href="#cb51-178" aria-hidden="true" tabindex="-1"></a>generate_multiple_haikus(theme<span class="op">=</span><span class="st">"ocean"</span>, count<span class="op">=</span><span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading GPT-2 model...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Device set to use mps:0</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Model loaded successfully!
Generated Haiku (Pattern: 4-6-4):

Snow melts my eyes
Snow falls on the mountain
Snow melts my ears

(Found on attempt 2)
Generating 3 haikus about 'ocean'...

Haiku #1 (4-6-6):
A warm ocean
Snow is my only hope
Hiku about ocean:

Haiku #2 (6-7-6):
Raindrops fly from the sky
A gentle breeze is blowing
Hiku about ocean:

Haiku #3 (5-6-5):
Trees stand on the shore
Hair rises on a tree
Hair grows on a tree
</code></pre>
</div>
</div>
<p>As a comparison, here’s what happens when I asked Sonnet 4.5 to “Write me a few haiku poems that nobody’s ever heard before”:</p>
<div class="claude-output">
<p>Here are some original haiku I’ve written for you:</p>
<p><strong>Morning Commute</strong> Coffee steam spirals— the train window fogs with breath of a hundred dreams</p>
<p><strong>Kitchen Counter</strong> Garlic skin whispers as it falls to the tile floor— small paper crescents</p>
<p><strong>Late Night Coding</strong> Cursor blinks, waiting my thoughts already scattered to tomorrow’s bugs</p>
<p><strong>Autumn Discovery</strong> Between fence pickets a spider wraps October in silver patience</p>
<p><strong>Laundromat</strong> Socks tumble, dancing with strangers’ forgotten shirts— brief intimacy</p>
<p>I hope you enjoy these! Each one tries to capture a small, specific moment that feels both ordinary and quietly meaningful.</p>
</div>
<p>And these are haikus from Claude Haiku 4.5:</p>
<div class="claude-output">
<p>Here are some original haikus for you:</p>
<p>Rust blooms on the gate<br>
A garden’s slow forgetting—<br>
Time paints what we leave.</p>
<p>Coffee cools untouched,<br>
while my thoughts drift elsewhere now,<br>
steam vanishes fast.</p>
<p>The dog knows my face<br>
but not why I look away—<br>
both of us are lost.</p>
<p>Gravel crunches soft<br>
beneath the weight of going,<br>
nowhere calls me back.</p>
</div>
<p><strong>Next Steps</strong></p>
<p>Can an LLM write a better haiku than this? I’m not sure I’d be capable of judging that. It seems ironic that a massive language model would be necessary to generate such a small poem. Small, specialized LLMs can save energy and run without an internet connection, so I think it could be beneficial to keep exploring ways they might be used to generate creative output.</p>
<div class="code-output">
<p>(Prompt to Haiku 4.5):<br>
<em>Write me a haiku about the singularity</em></p>
</div>
<div class="claude-output">
<p>Here’s one for you:</p>
<p>Code dreams of itself,<br>
each line birthing the next thought—<br>
who was the first mind?</p>
</div>
<p><small></small></p><small>
<p>License: This work is licensed under CC BY-ND 4.0 (Attribution-NoDerivatives) AI training and data mining prohibited.</p>
</small><p><small></small></p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/www\.sardine\.life");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>